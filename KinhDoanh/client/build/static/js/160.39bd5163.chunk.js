"use strict";(self.webpackChunkkho_mvg_client=self.webpackChunkkho_mvg_client||[]).push([[160,521],{3519:(e,s,n)=>{n.d(s,{A:()=>m});var i=n(9379),a=n(45),r=n(8139),t=n.n(r),c=n(5043),l=n(7852),o=n(579);const d=["bsPrefix","fluid","as","className"],h=c.forwardRef((e,s)=>{let{bsPrefix:n,fluid:r=!1,as:c="div",className:h}=e,m=(0,a.A)(e,d);const u=(0,l.oU)(n,"container"),g="string"===typeof r?"-".concat(r):"-fluid";return(0,o.jsx)(c,(0,i.A)((0,i.A)({ref:s},m),{},{className:t()(h,r?"".concat(u).concat(g):u)}))});h.displayName="Container";const m=h},6310:(e,s,n)=>{n.r(s),n.d(s,{default:()=>w});var i=n(9379),a=n(5043),r=n(1719),t=n(4063),c=n(4282),l=n(8628),o=n(8602),d=n(3519),h=n(3722),m=n(2557),u=n(326),g=n(1072),j=n(5328),x=n(4196),v=n(5016),p=n(6471),y=n(2550),A=n(9635),f=n(5048),b=n(9722),N=n(579);const w=function(){var e,s,n,w;const{isAdmin:k,hasPermission:_}=(0,v.As)(),{showSuccess:S,showError:C}=(0,p.hN)(),[I,T]=(0,a.useState)(!0),[z,L]=(0,a.useState)([]),[X,B]=(0,a.useState)(null),[E,P]=(0,a.useState)(!1),[q,D]=(0,a.useState)(!1),[K,U]=(0,a.useState)(!1),[H,Q]=(0,a.useState)("list"),[V,F]=(0,a.useState)({search:"",role:"",page:1,limit:20});(0,a.useEffect)(()=>{(_("user_view")||k())&&M()},[V]);const M=(0,a.useCallback)(async()=>{try{T(!0);const e=localStorage.getItem("token");console.log("Loading users with token:",e?"Present":"Missing"),console.log("Filters:",V);const s=await b.A.get("/api/users",{params:V,headers:{Authorization:"Bearer ".concat(e)}});if(console.log("Users API response:",s.data),!s.data.success)throw new Error(s.data.message||"Failed to load users");L(s.data.data.users||[])}catch(n){var e,s;console.error("Error loading users:",n),C((null===(e=n.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.message)||n.message||"L\u1ed7i t\u1ea3i danh s\xe1ch ng\u01b0\u1eddi d\xf9ng"),L([])}finally{T(!1)}},[V,C]);(0,a.useEffect)(()=>{(_("user_read")||k)&&M()},[_,k,M]);const O=e=>{const s={admin:{variant:"danger",label:"Admin"},manager:{variant:"success",label:"Manager"},staff:{variant:"primary",label:"Staff"},viewer:{variant:"secondary",label:"Viewer"}}[e]||{variant:"secondary",label:e};return(0,N.jsx)(t.A,{bg:s.variant,children:s.label})},J=e=>e?(0,N.jsx)(t.A,{bg:"success",children:"Ho\u1ea1t \u0111\u1ed9ng"}):(0,N.jsx)(t.A,{bg:"secondary",children:"V\xf4 hi\u1ec7u h\xf3a"});return I?(0,N.jsx)(y.A,{text:"\u0110ang t\u1ea3i danh s\xe1ch ng\u01b0\u1eddi d\xf9ng..."}):k()||_("user_view")?(0,N.jsxs)(d.A,{fluid:!0,className:"p-4",children:[(0,N.jsx)(g.A,{className:"mb-4",children:(0,N.jsx)(o.A,{children:(0,N.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,N.jsxs)("div",{children:[(0,N.jsx)("h2",{className:"mb-1",children:"Qu\u1ea3n l\xfd Ng\u01b0\u1eddi d\xf9ng"}),(0,N.jsx)("p",{className:"text-muted mb-0",children:"Ph\xe2n h\u1ec7 2.4 - Qu\u1ea3n l\xfd ng\u01b0\u1eddi d\xf9ng v\xe0 ph\xe2n quy\u1ec1n n\xe2ng cao"})]}),_("user_create")&&(0,N.jsxs)(c.A,{variant:"primary",children:[(0,N.jsx)("i",{className:"fas fa-plus me-2"}),"Th\xeam ng\u01b0\u1eddi d\xf9ng"]})]})})}),(0,N.jsxs)(l.A,{className:"border-0 shadow-sm",children:[(0,N.jsx)(l.A.Header,{className:"bg-white border-0",children:(0,N.jsxs)(u.A,{variant:"tabs",className:"border-0",activeKey:H,onSelect:Q,children:[(0,N.jsx)(u.A.Item,{children:(0,N.jsxs)(u.A.Link,{eventKey:"list",children:[(0,N.jsx)("i",{className:"fas fa-users me-2"}),"Danh s\xe1ch ng\u01b0\u1eddi d\xf9ng"]})}),k()&&(0,N.jsx)(u.A.Item,{children:(0,N.jsxs)(u.A.Link,{eventKey:"activity",children:[(0,N.jsx)("i",{className:"fas fa-history me-2"}),"L\u1ecbch s\u1eed ho\u1ea1t \u0111\u1ed9ng"]})}),(0,N.jsx)(u.A.Item,{children:(0,N.jsxs)(u.A.Link,{eventKey:"ai-stats",children:[(0,N.jsx)("i",{className:"fas fa-robot me-2"}),"Th\u1ed1ng k\xea AI"]})})]})}),(0,N.jsx)(l.A.Body,{children:(0,N.jsxs)(j.A.Content,{children:[(0,N.jsxs)(j.A.Pane,{eventKey:"list",className:"list"===H?"show active":"",children:[(0,N.jsxs)(g.A,{className:"mb-3",children:[(0,N.jsx)(o.A,{md:4,children:(0,N.jsx)(h.A.Control,{type:"text",placeholder:"T\xecm ki\u1ebfm ng\u01b0\u1eddi d\xf9ng...",value:V.search,onChange:e=>F(s=>(0,i.A)((0,i.A)({},s),{},{search:e.target.value}))})}),(0,N.jsx)(o.A,{md:3,children:(0,N.jsxs)(h.A.Select,{value:V.role,onChange:e=>F(s=>(0,i.A)((0,i.A)({},s),{},{role:e.target.value})),children:[(0,N.jsx)("option",{value:"",children:"T\u1ea5t c\u1ea3 vai tr\xf2"}),(0,N.jsx)("option",{value:"admin",children:"Admin"}),(0,N.jsx)("option",{value:"manager",children:"Manager"}),(0,N.jsx)("option",{value:"staff",children:"Staff"}),(0,N.jsx)("option",{value:"viewer",children:"Viewer"})]})}),(0,N.jsx)(o.A,{md:3,children:(0,N.jsxs)(c.A,{variant:"outline-secondary",onClick:()=>F({search:"",role:"",page:1,limit:20}),children:[(0,N.jsx)("i",{className:"fas fa-times me-2"}),"X\xf3a b\u1ed9 l\u1ecdc"]})})]}),(0,N.jsx)("div",{className:"table-responsive",children:(0,N.jsxs)(x.A,{hover:!0,children:[(0,N.jsx)("thead",{className:"bg-light",children:(0,N.jsxs)("tr",{children:[(0,N.jsx)("th",{children:"Ng\u01b0\u1eddi d\xf9ng"}),(0,N.jsx)("th",{children:"Vai tr\xf2"}),(0,N.jsx)("th",{children:"Tr\u1ea1ng th\xe1i"}),(0,N.jsx)("th",{children:"D\u1ef1 \xe1n \u0111\u01b0\u1ee3c g\xe1n"}),(0,N.jsx)("th",{children:"AI Configs"}),(0,N.jsx)("th",{children:"Ho\u1ea1t \u0111\u1ed9ng cu\u1ed1i"}),(0,N.jsx)("th",{children:"Thao t\xe1c"})]})}),(0,N.jsx)("tbody",{children:z.map(e=>(0,N.jsxs)("tr",{children:[(0,N.jsx)("td",{children:(0,N.jsxs)("div",{children:[(0,N.jsx)("div",{className:"fw-bold",children:e.full_name}),(0,N.jsxs)("small",{className:"text-muted",children:[e.username," \u2022 ",e.email]})]})}),(0,N.jsx)("td",{children:O(e.role)}),(0,N.jsx)("td",{children:J(e.is_active)}),(0,N.jsx)("td",{children:(0,N.jsx)(t.A,{bg:"info",children:e.assigned_projects||0})}),(0,N.jsx)("td",{children:(0,N.jsx)(t.A,{bg:"warning",children:e.ai_configs_count||0})}),(0,N.jsx)("td",{children:e.last_activity?new Date(e.last_activity).toLocaleDateString("vi-VN"):"Ch\u01b0a c\xf3"}),(0,N.jsx)("td",{children:(0,N.jsxs)("div",{className:"btn-group",children:[(0,N.jsx)(c.A,{variant:"outline-primary",size:"sm",onClick:()=>(async e=>{try{const s=localStorage.getItem("token");console.log("Viewing user:",e);const n=await b.A.get("/api/users/".concat(e),{headers:{Authorization:"Bearer ".concat(s)}});console.log("User details response:",n.data),B(n.data.data||n.data.user),P(!0)}catch(i){var s,n;console.error("Error viewing user:",i),C((null===(s=i.response)||void 0===s||null===(n=s.data)||void 0===n?void 0:n.message)||"L\u1ed7i t\u1ea3i th\xf4ng tin ng\u01b0\u1eddi d\xf9ng")}})(e.id),children:(0,N.jsx)("i",{className:"fas fa-eye"})}),_("user_permissions_manage")&&(0,N.jsx)(c.A,{variant:"outline-success",size:"sm",onClick:()=>(async e=>{try{const s=localStorage.getItem("token");console.log("Loading permissions for user:",e);const n=await b.A.get("/api/users/".concat(e),{headers:{Authorization:"Bearer ".concat(s)}});if(console.log("User permissions response:",n.data),!n.data.success)throw new Error("Failed to load user data");{const e=n.data.data;console.log("Setting selected user data:",e),B(e),D(!0)}}catch(i){var s,n;console.error("Error loading user permissions:",i),C((null===(s=i.response)||void 0===s||null===(n=s.data)||void 0===n?void 0:n.message)||"L\u1ed7i t\u1ea3i quy\u1ec1n h\u1ea1n ng\u01b0\u1eddi d\xf9ng")}})(e.id),title:"Qu\u1ea3n l\xfd quy\u1ec1n h\u1ea1n",children:(0,N.jsx)("i",{className:"fas fa-key"})}),_("user_ai_manage")&&(0,N.jsx)(c.A,{variant:"outline-warning",size:"sm",onClick:()=>(async e=>{try{const s=localStorage.getItem("token");console.log("Loading AI configs for user:",e);const n=await b.A.get("/api/users/".concat(e),{headers:{Authorization:"Bearer ".concat(s)}});try{const a=await b.A.get("/api/ai-assistant/user-configs",{params:{user_id:e},headers:{Authorization:"Bearer ".concat(s)}});B((0,i.A)((0,i.A)({},n.data.data),{},{ai_configurations:a.data.data||[]}))}catch(a){console.log("AI configs endpoint not found, using basic user data"),B(n.data.data)}U(!0)}catch(r){var s,n;console.error("Error loading AI configs:",r),C((null===(s=r.response)||void 0===s||null===(n=s.data)||void 0===n?void 0:n.message)||"L\u1ed7i t\u1ea3i c\u1ea5u h\xecnh AI")}})(e.id),title:"C\u1ea5u h\xecnh AI",children:(0,N.jsx)("i",{className:"fas fa-robot"})}),(k()||_("user_logs_view"))&&(0,N.jsx)(c.A,{variant:"outline-info",size:"sm",onClick:()=>(async e=>{try{const s=await b.A.get("/api/users/".concat(e,"/activity-logs"));B(e=>(0,i.A)((0,i.A)({},e),{},{activity_logs:s.data.data.logs}))}catch(s){C("L\u1ed7i t\u1ea3i l\u1ecbch s\u1eed ho\u1ea1t \u0111\u1ed9ng")}})(e.id),title:"L\u1ecbch s\u1eed ho\u1ea1t \u0111\u1ed9ng",children:(0,N.jsx)("i",{className:"fas fa-history"})})]})})]},e.id))})]})})]}),k()&&(0,N.jsx)(j.A.Pane,{eventKey:"activity",className:"activity"===H?"show active":"",children:(0,N.jsxs)(r.A,{variant:"info",children:[(0,N.jsx)("i",{className:"fas fa-info-circle me-2"}),"T\xednh n\u0103ng xem l\u1ecbch s\u1eed ho\u1ea1t \u0111\u1ed9ng t\u1ed5ng h\u1ee3p s\u1ebd \u0111\u01b0\u1ee3c tri\u1ec3n khai \u1edf component ri\xeang"]})}),(0,N.jsxs)(j.A.Pane,{eventKey:"ai-stats",className:"ai-stats"===H?"show active":"",children:[(0,N.jsxs)(g.A,{children:[(0,N.jsx)(o.A,{md:4,children:(0,N.jsx)(l.A,{className:"border-0 shadow-sm text-center",children:(0,N.jsxs)(l.A.Body,{children:[(0,N.jsx)("i",{className:"fas fa-users fa-2x text-primary mb-2"}),(0,N.jsx)("h4",{className:"mb-1",children:z.filter(e=>e.ai_configs_count>0).length}),(0,N.jsx)("p",{className:"text-muted mb-0",children:"Users c\xf3 AI config"})]})})}),(0,N.jsx)(o.A,{md:4,children:(0,N.jsx)(l.A,{className:"border-0 shadow-sm text-center",children:(0,N.jsxs)(l.A.Body,{children:[(0,N.jsx)("i",{className:"fas fa-robot fa-2x text-success mb-2"}),(0,N.jsx)("h4",{className:"mb-1",children:z.reduce((e,s)=>e+(s.ai_configs_count||0),0)}),(0,N.jsx)("p",{className:"text-muted mb-0",children:"T\u1ed5ng AI configs"})]})})}),(0,N.jsx)(o.A,{md:4,children:(0,N.jsx)(l.A,{className:"border-0 shadow-sm text-center",children:(0,N.jsxs)(l.A.Body,{children:[(0,N.jsx)("i",{className:"fas fa-chart-line fa-2x text-warning mb-2"}),(0,N.jsx)("h4",{className:"mb-1",children:"$0.00"}),(0,N.jsx)("p",{className:"text-muted mb-0",children:"Chi ph\xed AI th\xe1ng n\xe0y"})]})})})]}),(0,N.jsxs)(l.A,{className:"mt-4",children:[(0,N.jsx)(l.A.Header,{children:(0,N.jsx)("h6",{className:"mb-0",children:"Ph\xe2n b\u1ed1 AI Providers"})}),(0,N.jsx)(l.A.Body,{children:(0,N.jsx)(r.A,{variant:"info",children:"Chart th\u1ed1ng k\xea AI providers s\u1ebd \u0111\u01b0\u1ee3c tri\u1ec3n khai v\u1edbi d\u1eef li\u1ec7u th\u1ef1c t\u1ebf"})})]})]})]})})]}),(0,N.jsxs)(m.A,{show:E,onHide:()=>P(!1),size:"lg",children:[(0,N.jsx)(m.A.Header,{closeButton:!0,children:(0,N.jsx)(m.A.Title,{children:"Chi ti\u1ebft ng\u01b0\u1eddi d\xf9ng"})}),(0,N.jsx)(m.A.Body,{children:X&&(0,N.jsxs)(g.A,{children:[(0,N.jsxs)(o.A,{md:6,children:[(0,N.jsx)("h6",{children:"Th\xf4ng tin c\u01a1 b\u1ea3n"}),(0,N.jsxs)("div",{className:"info-group",children:[(0,N.jsxs)("div",{children:[(0,N.jsx)("strong",{children:"T\xean:"})," ",X.user.full_name]}),(0,N.jsxs)("div",{children:[(0,N.jsx)("strong",{children:"Username:"})," ",X.user.username]}),(0,N.jsxs)("div",{children:[(0,N.jsx)("strong",{children:"Email:"})," ",X.user.email]}),(0,N.jsxs)("div",{children:[(0,N.jsx)("strong",{children:"Vai tr\xf2:"})," ",O(X.user.role)]}),(0,N.jsxs)("div",{children:[(0,N.jsx)("strong",{children:"Tr\u1ea1ng th\xe1i:"})," ",J(X.user.is_active)]})]})]}),(0,N.jsxs)(o.A,{md:6,children:[(0,N.jsx)("h6",{children:"Th\u1ed1ng k\xea"}),(0,N.jsxs)("div",{className:"info-group",children:[(0,N.jsxs)("div",{children:[(0,N.jsx)("strong",{children:"D\u1ef1 \xe1n \u0111\u01b0\u1ee3c g\xe1n:"})," ",(null===(e=X.project_permissions)||void 0===e?void 0:e.length)||0]}),(0,N.jsxs)("div",{children:[(0,N.jsx)("strong",{children:"AI Configs:"})," ",(null===(s=X.ai_configurations)||void 0===s?void 0:s.length)||0]}),(0,N.jsxs)("div",{children:[(0,N.jsx)("strong",{children:"Ng\xe0y t\u1ea1o:"})," ",new Date(X.user.created_at).toLocaleDateString("vi-VN")]}),(0,N.jsxs)("div",{children:[(0,N.jsx)("strong",{children:"\u0110\u0103ng nh\u1eadp cu\u1ed1i:"})," ",X.user.last_login?new Date(X.user.last_login).toLocaleDateString("vi-VN"):"Ch\u01b0a c\xf3"]})]})]})]})}),(0,N.jsx)(m.A.Footer,{children:(0,N.jsx)(c.A,{variant:"secondary",onClick:()=>P(!1),children:"\u0110\xf3ng"})})]}),(0,N.jsx)(f.default,{user:X,userId:(null===X||void 0===X||null===(n=X.user)||void 0===n?void 0:n.id)||(null===X||void 0===X?void 0:X.id),show:K,onHide:()=>{U(!1),B(null)},onSave:()=>{M(),S("C\u1ea5u h\xecnh AI \u0111\xe3 \u0111\u01b0\u1ee3c c\u1eadp nh\u1eadt th\xe0nh c\xf4ng!")}}),(0,N.jsx)(A.default,{user:X,userId:(null===X||void 0===X||null===(w=X.user)||void 0===w?void 0:w.id)||(null===X||void 0===X?void 0:X.id),show:q,onHide:()=>{D(!1),B(null)},onSave:()=>{M(),S("C\u1eadp nh\u1eadt quy\u1ec1n h\u1ea1n th\xe0nh c\xf4ng!")}})]}):(0,N.jsx)(d.A,{className:"mt-5",children:(0,N.jsxs)(r.A,{variant:"danger",className:"text-center",children:[(0,N.jsx)("h4",{children:"Kh\xf4ng c\xf3 quy\u1ec1n truy c\u1eadp"}),(0,N.jsx)("p",{children:"B\u1ea1n kh\xf4ng c\xf3 quy\u1ec1n qu\u1ea3n l\xfd ng\u01b0\u1eddi d\xf9ng."})]})})}},9635:(e,s,n)=>{n.r(s),n.d(s,{default:()=>x});var i=n(9379),a=n(5043),r=n(2557),t=n(1719),c=n(9422),l=n(5328),o=n(4063),d=n(4196),h=n(3722),m=n(4282),u=n(579);const g=[{key:"all",label:"To\xe0n quy\u1ec1n",description:"Quy\u1ec1n admin - truy c\u1eadp t\u1ea5t c\u1ea3",color:"danger"},{key:"project_view",label:"Xem d\u1ef1 \xe1n",description:"Xem th\xf4ng tin d\u1ef1 \xe1n",color:"info"},{key:"project_edit",label:"S\u1eeda d\u1ef1 \xe1n",description:"Ch\u1ec9nh s\u1eeda th\xf4ng tin d\u1ef1 \xe1n",color:"warning"},{key:"project_delete",label:"X\xf3a d\u1ef1 \xe1n",description:"X\xf3a d\u1ef1 \xe1n (nguy hi\u1ec3m)",color:"danger"},{key:"customer_view",label:"Xem kh\xe1ch h\xe0ng",description:"Xem th\xf4ng tin kh\xe1ch h\xe0ng",color:"info"},{key:"customer_edit",label:"S\u1eeda kh\xe1ch h\xe0ng",description:"Ch\u1ec9nh s\u1eeda kh\xe1ch h\xe0ng",color:"warning"},{key:"contract_view",label:"Xem h\u1ee3p \u0111\u1ed3ng",description:"Xem h\u1ee3p \u0111\u1ed3ng",color:"info"},{key:"contract_edit",label:"S\u1eeda h\u1ee3p \u0111\u1ed3ng",description:"Ch\u1ec9nh s\u1eeda h\u1ee3p \u0111\u1ed3ng",color:"warning"},{key:"document_view",label:"Xem t\xe0i li\u1ec7u",description:"Xem t\xe0i li\u1ec7u",color:"info"},{key:"document_upload",label:"Upload t\xe0i li\u1ec7u",description:"Upload file t\xe0i li\u1ec7u",color:"warning"},{key:"user_view",label:"Xem users",description:"Xem danh s\xe1ch users",color:"info"},{key:"user_manage",label:"Qu\u1ea3n l\xfd users",description:"T\u1ea1o/s\u1eeda/x\xf3a users",color:"danger"},{key:"report_view",label:"Xem b\xe1o c\xe1o",description:"Xem c\xe1c b\xe1o c\xe1o",color:"info"},{key:"ai_use",label:"S\u1eed d\u1ee5ng AI",description:"S\u1eed d\u1ee5ng AI chatbot",color:"primary"}],j=[{key:"view",label:"Xem",description:"Xem th\xf4ng tin d\u1ef1 \xe1n",color:"info"},{key:"edit",label:"S\u1eeda",description:"Ch\u1ec9nh s\u1eeda d\u1ef1 \xe1n",color:"warning"},{key:"manage_zones",label:"Qu\u1ea3n l\xfd zones",description:"Th\xeam/s\u1eeda/x\xf3a zones",color:"primary"},{key:"manage_contracts",label:"Qu\u1ea3n l\xfd h\u1ee3p \u0111\u1ed3ng",description:"T\u1ea1o/s\u1eeda h\u1ee3p \u0111\u1ed3ng",color:"success"},{key:"view_financials",label:"Xem t\xe0i ch\xednh",description:"Xem th\xf4ng tin t\xe0i ch\xednh",color:"warning"}];const x=function(e){let{user:s,userId:n,show:x,onHide:v,onSave:p}=e;const[y,A]=(0,a.useState)(!1),[f,b]=(0,a.useState)(""),[N,w]=(0,a.useState)(""),[k,_]=(0,a.useState)([]),[S,C]=(0,a.useState)([]),[I,T]=(0,a.useState)([]),[z,L]=(0,a.useState)(""),[,]=(0,a.useState)([]),[X,B]=(0,a.useState)("system");(0,a.useEffect)(()=>{const e=n||(null===s||void 0===s?void 0:s.id);x&&e&&(E(),P())},[x,n,null===s||void 0===s?void 0:s.id]);const E=(0,a.useCallback)(async()=>{try{const a=n||(null===s||void 0===s?void 0:s.id);if(console.log("Loading permissions for user ID:",a),!a)throw new Error("User ID not found");const r=localStorage.getItem("token"),t=await fetch("/api/users/".concat(a),{headers:{Authorization:"Bearer ".concat(r)}});if(!t.ok)throw new Error("HTTP ".concat(t.status,": ").concat(t.statusText));const c=await t.json();if(console.log("User permissions data:",c),c.success){var e,i;const s=(null===(e=c.data)||void 0===e?void 0:e.user)||c.data;_(s.permissions||[]),C((null===(i=c.data)||void 0===i?void 0:i.project_permissions)||[])}}catch(f){console.error("Error loading permissions:",f),b("Kh\xf4ng th\u1ec3 t\u1ea3i quy\u1ec1n h\u1ea1n: "+f.message)}},[n,null===s||void 0===s?void 0:s.id]),P=async()=>{try{const s=localStorage.getItem("token");console.log("Loading available projects...");const n=await fetch("/api/projects?limit=1000",{headers:{Authorization:"Bearer ".concat(s)}});if(n.ok){const s=await n.json();var e;if(s.success)T(s.data.projects||[]),console.log("Projects loaded:",(null===(e=s.data.projects)||void 0===e?void 0:e.length)||0)}else console.warn("Projects API not available:",n.status),T([])}catch(f){console.warn("Error loading projects:",f.message),T([])}},q=k.includes("all");return(0,u.jsxs)(r.A,{show:x,onHide:v,size:"xl",centered:!0,children:[(0,u.jsx)(r.A.Header,{closeButton:!0,children:(0,u.jsxs)(r.A.Title,{children:[(0,u.jsx)("i",{className:"bi bi-shield-lock"})," Qu\u1ea3n l\xfd quy\u1ec1n h\u1ea1n",s&&(0,u.jsxs)("div",{className:"text-muted",style:{fontSize:"14px",marginTop:"4px"},children:["User: ",(0,u.jsx)("strong",{children:s.username})," - ",s.full_name]})]})}),(0,u.jsxs)(r.A.Body,{style:{maxHeight:"70vh",overflowY:"auto"},children:[f&&(0,u.jsx)(t.A,{variant:"danger",onClose:()=>b(""),dismissible:!0,children:f}),N&&(0,u.jsx)(t.A,{variant:"success",children:N}),(0,u.jsxs)(c.A,{activeKey:X,onSelect:B,className:"mb-3",children:[(0,u.jsx)(l.A,{eventKey:"system",title:(0,u.jsxs)("span",{children:[(0,u.jsx)("i",{className:"bi bi-gear-fill"})," Quy\u1ec1n h\u1ec7 th\u1ed1ng",(0,u.jsx)(o.A,{bg:"primary",className:"ms-2",children:k.length})]}),children:(0,u.jsxs)("div",{className:"permission-matrix",children:[q&&(0,u.jsxs)(t.A,{variant:"warning",children:[(0,u.jsx)("i",{className:"bi bi-exclamation-triangle-fill"})," User n\xe0y c\xf3 quy\u1ec1n ",(0,u.jsx)("strong",{children:"ADMIN"})," - truy c\u1eadp t\u1ea5t c\u1ea3 ch\u1ee9c n\u0103ng"]}),(0,u.jsxs)(d.A,{hover:!0,responsive:!0,children:[(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{style:{width:"50px"}}),(0,u.jsx)("th",{children:"Quy\u1ec1n"}),(0,u.jsx)("th",{children:"M\xf4 t\u1ea3"}),(0,u.jsx)("th",{style:{width:"100px"},children:"Tr\u1ea1ng th\xe1i"})]})}),(0,u.jsx)("tbody",{children:g.map(e=>{const s=k.includes(e.key),n=q&&"all"!==e.key;return(0,u.jsxs)("tr",{className:s?"table-active":"",children:[(0,u.jsx)("td",{children:(0,u.jsx)(h.A.Check,{type:"checkbox",checked:s,onChange:()=>{return s=e.key,void(k.includes("all")&&"all"!==s||_(e=>"all"===s?e.includes("all")?[]:["all"]:e.includes(s)?e.filter(e=>e!==s):[...e,s]));var s},disabled:n})}),(0,u.jsxs)("td",{children:[(0,u.jsx)("strong",{children:e.label}),(0,u.jsx)(o.A,{bg:e.color,className:"ms-2",children:e.key})]}),(0,u.jsx)("td",{className:"text-muted",children:e.description}),(0,u.jsx)("td",{children:s?(0,u.jsx)(o.A,{bg:"success",children:"C\xf3 quy\u1ec1n"}):(0,u.jsx)(o.A,{bg:"secondary",children:"Kh\xf4ng"})})]},e.key)})})]})]})}),(0,u.jsxs)(l.A,{eventKey:"projects",title:(0,u.jsxs)("span",{children:[(0,u.jsx)("i",{className:"bi bi-building"})," Quy\u1ec1n d\u1ef1 \xe1n",(0,u.jsx)(o.A,{bg:"success",className:"ms-2",children:S.length})]}),children:[(0,u.jsxs)("div",{className:"add-project-form mb-4 p-3 border rounded bg-light",children:[(0,u.jsxs)("h6",{className:"mb-3",children:[(0,u.jsx)("i",{className:"bi bi-plus-circle"})," Assign user v\xe0o d\u1ef1 \xe1n"]}),(0,u.jsxs)("div",{className:"row g-2 align-items-end",children:[(0,u.jsxs)("div",{className:"col-md-8",children:[(0,u.jsx)(h.A.Label,{children:"Ch\u1ecdn d\u1ef1 \xe1n"}),(0,u.jsxs)(h.A.Select,{value:z,onChange:e=>L(e.target.value),children:[(0,u.jsx)("option",{value:"",children:"-- Ch\u1ecdn d\u1ef1 \xe1n --"}),I.filter(e=>!S.some(s=>s.project_id===e.id)).map(e=>(0,u.jsxs)("option",{value:e.id,children:[e.name," (",e.code,")"]},e.id))]})]}),(0,u.jsx)("div",{className:"col-md-4",children:(0,u.jsxs)(m.A,{variant:"primary",onClick:()=>{if(!z)return void b("Vui l\xf2ng ch\u1ecdn d\u1ef1 \xe1n");if(S.some(e=>e.project_id===parseInt(z)))return void b("D\u1ef1 \xe1n n\xe0y \u0111\xe3 \u0111\u01b0\u1ee3c assign");const e=I.find(e=>e.id===parseInt(z));C(s=>[...s,{project_id:parseInt(z),project_name:e.name,permissions:["view"]}]),L(""),b("")},disabled:!z,className:"w-100",children:[(0,u.jsx)("i",{className:"bi bi-plus"})," Th\xeam"]})})]})]}),0===S.length?(0,u.jsxs)(t.A,{variant:"info",children:[(0,u.jsx)("i",{className:"bi bi-info-circle"})," User ch\u01b0a \u0111\u01b0\u1ee3c assign v\xe0o d\u1ef1 \xe1n n\xe0o. S\u1eed d\u1ee5ng form b\xean tr\xean \u0111\u1ec3 assign."]}):(0,u.jsx)("div",{className:"project-assignments",children:S.map(e=>{const s=I.find(s=>s.id===e.project_id);return(0,u.jsxs)("div",{className:"project-card mb-3 p-3 border rounded",children:[(0,u.jsxs)("div",{className:"d-flex justify-content-between align-items-start mb-3",children:[(0,u.jsxs)("div",{children:[(0,u.jsxs)("h6",{className:"mb-1",children:[(0,u.jsx)("i",{className:"bi bi-building"})," ",e.project_name||(null===s||void 0===s?void 0:s.name)]}),s&&(0,u.jsxs)("small",{className:"text-muted",children:["Code: ",s.code]})]}),(0,u.jsxs)(m.A,{variant:"outline-danger",size:"sm",onClick:()=>{return s=e.project_id,void C(e=>e.filter(e=>e.project_id!==s));var s},children:[(0,u.jsx)("i",{className:"bi bi-trash"})," X\xf3a"]})]}),(0,u.jsx)("div",{className:"permissions-grid",children:j.map(s=>{const n=(e.permissions||[]).includes(s.key);return(0,u.jsx)("div",{className:"permission-item",children:(0,u.jsx)(h.A.Check,{type:"checkbox",id:"".concat(e.project_id,"-").concat(s.key),label:(0,u.jsxs)("span",{children:[(0,u.jsx)("strong",{children:s.label}),(0,u.jsx)("br",{}),(0,u.jsx)("small",{className:"text-muted",children:s.description})]}),checked:n,onChange:()=>{return n=e.project_id,a=s.key,void C(e=>e.map(e=>{if(e.project_id===n){const s=e.permissions||[];return s.includes(a)?(0,i.A)((0,i.A)({},e),{},{permissions:s.filter(e=>e!==a)}):(0,i.A)((0,i.A)({},e),{},{permissions:[...s,a]})}return e}));var n,a}})},s.key)})})]},e.project_id)})})]})]})]}),(0,u.jsxs)(r.A.Footer,{children:[(0,u.jsx)(m.A,{variant:"secondary",onClick:v,disabled:y,children:"H\u1ee7y"}),(0,u.jsx)(m.A,{variant:"primary",onClick:async()=>{A(!0),b(""),w("");try{const e=n||(null===s||void 0===s?void 0:s.id);if(console.log("Saving permissions for user ID:",e),!e)throw new Error("User ID not found");const i=localStorage.getItem("token");console.log("Saving system permissions:",k);const a=await fetch("/api/users/".concat(e,"/permissions"),{method:"PUT",headers:{Authorization:"Bearer ".concat(i),"Content-Type":"application/json"},body:JSON.stringify({permissions:k})});if(!a.ok){const e=await a.json().catch(()=>({}));throw new Error(e.message||"Kh\xf4ng th\u1ec3 c\u1eadp nh\u1eadt quy\u1ec1n h\u1ec7 th\u1ed1ng")}if(S.length>0){console.log("Saving project permissions:",S);const s=await fetch("/api/users/".concat(e,"/project-permissions"),{method:"POST",headers:{Authorization:"Bearer ".concat(i),"Content-Type":"application/json"},body:JSON.stringify({projects:S.map(e=>({project_id:e.project_id,permissions:e.permissions}))})});if(!s.ok){const e=await s.json().catch(()=>({}));throw new Error(e.message||"Kh\xf4ng th\u1ec3 c\u1eadp nh\u1eadt quy\u1ec1n d\u1ef1 \xe1n")}}w("C\u1eadp nh\u1eadt quy\u1ec1n h\u1ea1n th\xe0nh c\xf4ng!"),setTimeout(()=>{p&&p(),v()},1500)}catch(f){console.error("Error saving permissions:",f),b(f.message||"C\xf3 l\u1ed7i x\u1ea3y ra khi l\u01b0u quy\u1ec1n h\u1ea1n")}finally{A(!1)}},disabled:y,children:y?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01b0u..."]}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("i",{className:"bi bi-save"})," L\u01b0u thay \u0111\u1ed5i"]})})]})]})}}}]);
//# sourceMappingURL=160.39bd5163.chunk.js.map