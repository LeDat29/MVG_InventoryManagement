"use strict";(self.webpackChunkkho_mvg_client=self.webpackChunkkho_mvg_client||[]).push([[147],{4196:(e,s,r)=>{r.d(s,{A:()=>x});var l=r(9379),a=r(45),n=r(8139),d=r.n(n),i=r(5043),t=r(7852),o=r(579);const c=["bsPrefix","className","striped","bordered","borderless","hover","size","variant","responsive"],h=i.forwardRef((e,s)=>{let{bsPrefix:r,className:n,striped:i,bordered:h,borderless:x,hover:j,size:u,variant:m,responsive:v}=e,p=(0,a.A)(e,c);const A=(0,t.oU)(r,"table"),g=d()(n,A,m&&"".concat(A,"-").concat(m),u&&"".concat(A,"-").concat(u),i&&"".concat(A,"-").concat("string"===typeof i?"striped-".concat(i):"striped"),h&&"".concat(A,"-bordered"),x&&"".concat(A,"-borderless"),j&&"".concat(A,"-hover")),f=(0,o.jsx)("table",(0,l.A)((0,l.A)({},p),{},{className:g,ref:s}));if(v){let e="".concat(A,"-responsive");return"string"===typeof v&&(e="".concat(e,"-").concat(v)),(0,o.jsx)("div",{className:e,children:f})}return f});h.displayName="Table";const x=h},9147:(e,s,r)=>{r.r(s),r.d(s,{default:()=>g});var l=r(5043),a=r(1719),n=r(4063),d=r(4282),i=r(8628),t=r(8602),o=r(3519),c=r(3722),h=r(1072),x=r(4196),j=r(6058),u=r(7304),m=r(5016),v=r(2550),p=r(5528),A=r(579);u.t1.register(u.PP,u.kc,u.FN,u.No,u.E8,u.Bs,u.hE,u.m_,u.s$);const g=function(){var e,s,r,u,g,f,b,y,N,_,C,k,w,B,L,P,E,M;const{hasPermission:S}=(0,m.As)(),[H,T]=(0,l.useState)(null),[U,I]=(0,l.useState)(null),[z,D]=(0,l.useState)(!0),[F,R]=(0,l.useState)("24h"),[W,q]=(0,l.useState)(!0),G=(0,l.useCallback)(async()=>{try{const e=localStorage.getItem("token"),[s,r]=await Promise.all([fetch("/api/metrics/summary?timeframe=".concat(F),{headers:{Authorization:"Bearer ".concat(e)}}),fetch("/api/metrics/dashboard",{headers:{Authorization:"Bearer ".concat(e)}})]);if(s.ok&&r.ok){const e=await s.json(),l=await r.json();T(e.data),I(l.data)}}catch(e){console.error("Error loading metrics:",e)}finally{D(!1)}},[F]);(0,l.useEffect)(()=>{S("admin")&&G()},[S,G]),(0,l.useEffect)(()=>{let e;return W&&S("admin")&&(e=setInterval(G,3e4)),()=>clearInterval(e)},[W,S,G]);const K=e=>{if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]},O=e=>e<1e3?"".concat(Math.round(e),"ms"):"".concat((e/1e3).toFixed(2),"s");if(!S("admin"))return(0,A.jsx)(o.A,{className:"mt-4",children:(0,A.jsx)(a.A,{variant:"warning",children:"B\u1ea1n kh\xf4ng c\xf3 quy\u1ec1n truy c\u1eadp performance dashboard."})});if(z)return(0,A.jsx)(v.A,{text:"\u0110ang t\u1ea3i performance metrics..."});const Y={labels:["Load Time","DOM Ready","First Paint"],datasets:[{label:"Performance (ms)",data:null!==H&&void 0!==H&&H.pageLoad?[H.pageLoad.avg_load_time||0,H.pageLoad.avg_dom_ready||0,H.pageLoad.avg_first_paint||0]:[0,0,0],backgroundColor:["#007bff","#28a745","#ffc107"],borderColor:["#0056b3","#1e7e34","#d39e00"],borderWidth:1}]},Z={labels:["Success","Errors"],datasets:[{data:null!==H&&void 0!==H&&H.apiCalls?[(H.apiCalls.total_calls||0)-(H.apiCalls.error_count||0),H.apiCalls.error_count||0]:[0,0],backgroundColor:["#28a745","#dc3545"],borderColor:["#1e7e34","#bd2130"],borderWidth:1}]};return(0,A.jsxs)(o.A,{fluid:!0,className:"p-4",children:[(0,A.jsx)(h.A,{className:"mb-4",children:(0,A.jsx)(t.A,{children:(0,A.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,A.jsxs)("h2",{children:[(0,A.jsx)("i",{className:"fas fa-chart-line me-2"}),"Performance Dashboard"]}),(0,A.jsxs)("div",{className:"d-flex gap-2",children:[(0,A.jsxs)(c.A.Select,{value:F,onChange:e=>R(e.target.value),style:{width:"auto"},children:[(0,A.jsx)("option",{value:"1h",children:"Last Hour"}),(0,A.jsx)("option",{value:"24h",children:"Last 24 Hours"}),(0,A.jsx)("option",{value:"7d",children:"Last 7 Days"}),(0,A.jsx)("option",{value:"30d",children:"Last 30 Days"})]}),(0,A.jsxs)(d.A,{variant:W?"success":"outline-secondary",onClick:()=>q(!W),children:[(0,A.jsx)("i",{className:"fas fa-sync-alt me-2"}),"Auto Refresh"]}),(0,A.jsxs)(d.A,{variant:"outline-primary",onClick:()=>{p.A.exportMetrics()},children:[(0,A.jsx)("i",{className:"fas fa-download me-2"}),"Export"]})]})]})})}),(0,A.jsxs)(h.A,{className:"mb-4",children:[(0,A.jsx)(t.A,{md:3,children:(0,A.jsx)(i.A,{className:"text-center",children:(0,A.jsxs)(i.A.Body,{children:[(0,A.jsx)("h5",{children:"System Health"}),(e=>{switch(e){case"healthy":return(0,A.jsx)(n.A,{bg:"success",children:"Healthy"});case"warning":return(0,A.jsx)(n.A,{bg:"warning",children:"Warning"});case"error":return(0,A.jsx)(n.A,{bg:"danger",children:"Error"});default:return(0,A.jsx)(n.A,{bg:"secondary",children:"Unknown"})}})((null===U||void 0===U||null===(e=U.health)||void 0===e||null===(s=e.database)||void 0===s?void 0:s.status)||"unknown"),(0,A.jsx)("div",{className:"mt-2",children:(0,A.jsxs)("small",{children:["DB: ",(null===U||void 0===U||null===(r=U.health)||void 0===r||null===(u=r.database)||void 0===u?void 0:u.responseTime)||0,"ms"]})})]})})}),(0,A.jsx)(t.A,{md:3,children:(0,A.jsx)(i.A,{className:"text-center",children:(0,A.jsxs)(i.A.Body,{children:[(0,A.jsx)("h5",{children:"Active Users"}),(0,A.jsx)("h3",{className:"text-primary",children:(null===U||void 0===U?void 0:U.activeUsers)||0}),(0,A.jsx)("small",{children:"Last 15 minutes"})]})})}),(0,A.jsx)(t.A,{md:3,children:(0,A.jsx)(i.A,{className:"text-center",children:(0,A.jsxs)(i.A.Body,{children:[(0,A.jsx)("h5",{children:"Memory Usage"}),(0,A.jsx)("h4",{children:K((null===U||void 0===U||null===(g=U.health)||void 0===g||null===(f=g.memory)||void 0===f?void 0:f.heapUsed)||0)}),(0,A.jsxs)("small",{children:["of ",K((null===U||void 0===U||null===(b=U.health)||void 0===b||null===(y=b.memory)||void 0===y?void 0:y.heapTotal)||0)]})]})})}),(0,A.jsx)(t.A,{md:3,children:(0,A.jsx)(i.A,{className:"text-center",children:(0,A.jsxs)(i.A.Body,{children:[(0,A.jsx)("h5",{children:"Uptime"}),(0,A.jsxs)("h4",{children:[Math.floor(((null===U||void 0===U||null===(N=U.health)||void 0===N?void 0:N.uptime)||0)/3600),"h"]}),(0,A.jsx)("small",{children:"Server running"})]})})})]}),(0,A.jsxs)(h.A,{className:"mb-4",children:[(0,A.jsx)(t.A,{md:6,children:(0,A.jsxs)(i.A,{children:[(0,A.jsx)(i.A.Header,{children:(0,A.jsx)("h5",{children:"Page Load Performance"})}),(0,A.jsx)(i.A.Body,{children:null!==H&&void 0!==H&&H.pageLoad?(0,A.jsx)(j.yP,{data:Y,options:{responsive:!0,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Time (ms)"}}}}}):(0,A.jsx)("p",{className:"text-muted",children:"No data available"})})]})}),(0,A.jsx)(t.A,{md:6,children:(0,A.jsxs)(i.A,{children:[(0,A.jsx)(i.A.Header,{children:(0,A.jsx)("h5",{children:"API Call Success Rate"})}),(0,A.jsx)(i.A.Body,{children:null!==H&&void 0!==H&&H.apiCalls?(0,A.jsx)(j.nu,{data:Z,options:{responsive:!0,plugins:{legend:{position:"bottom"}}}}):(0,A.jsx)("p",{className:"text-muted",children:"No data available"})})]})})]}),(0,A.jsxs)(h.A,{children:[(0,A.jsx)(t.A,{md:6,children:(0,A.jsxs)(i.A,{children:[(0,A.jsx)(i.A.Header,{children:(0,A.jsx)("h5",{children:"Performance Summary"})}),(0,A.jsx)(i.A.Body,{children:(0,A.jsx)(x.A,{size:"sm",children:(0,A.jsxs)("tbody",{children:[(0,A.jsxs)("tr",{children:[(0,A.jsx)("td",{children:(0,A.jsx)("strong",{children:"Total Page Loads"})}),(0,A.jsx)("td",{children:(null===H||void 0===H||null===(_=H.pageLoad)||void 0===_?void 0:_.total_loads)||0})]}),(0,A.jsxs)("tr",{children:[(0,A.jsx)("td",{children:(0,A.jsx)("strong",{children:"Avg Load Time"})}),(0,A.jsx)("td",{children:O((null===H||void 0===H||null===(C=H.pageLoad)||void 0===C?void 0:C.avg_load_time)||0)})]}),(0,A.jsxs)("tr",{children:[(0,A.jsx)("td",{children:(0,A.jsx)("strong",{children:"Max Load Time"})}),(0,A.jsx)("td",{children:O((null===H||void 0===H||null===(k=H.pageLoad)||void 0===k?void 0:k.max_load_time)||0)})]}),(0,A.jsxs)("tr",{children:[(0,A.jsx)("td",{children:(0,A.jsx)("strong",{children:"Total API Calls"})}),(0,A.jsx)("td",{children:(null===H||void 0===H||null===(w=H.apiCalls)||void 0===w?void 0:w.total_calls)||0})]}),(0,A.jsxs)("tr",{children:[(0,A.jsx)("td",{children:(0,A.jsx)("strong",{children:"Avg API Duration"})}),(0,A.jsx)("td",{children:O((null===H||void 0===H||null===(B=H.apiCalls)||void 0===B?void 0:B.avg_duration)||0)})]}),(0,A.jsxs)("tr",{children:[(0,A.jsx)("td",{children:(0,A.jsx)("strong",{children:"API Error Rate"})}),(0,A.jsxs)("td",{children:[(((null===H||void 0===H||null===(L=H.apiCalls)||void 0===L?void 0:L.error_count)||0)/((null===H||void 0===H||null===(P=H.apiCalls)||void 0===P?void 0:P.total_calls)||1)*100).toFixed(1),"%"]})]})]})})})]})}),(0,A.jsx)(t.A,{md:6,children:(0,A.jsxs)(i.A,{children:[(0,A.jsx)(i.A.Header,{children:(0,A.jsx)("h5",{children:"Recent Errors"})}),(0,A.jsx)(i.A.Body,{style:{maxHeight:"300px",overflowY:"auto"},children:(null===H||void 0===H||null===(E=H.errors)||void 0===E||null===(M=E.topErrors)||void 0===M?void 0:M.length)>0?(0,A.jsxs)(x.A,{size:"sm",children:[(0,A.jsx)("thead",{children:(0,A.jsxs)("tr",{children:[(0,A.jsx)("th",{children:"Error Message"}),(0,A.jsx)("th",{children:"Count"})]})}),(0,A.jsx)("tbody",{children:H.errors.topErrors.map((e,s)=>(0,A.jsxs)("tr",{children:[(0,A.jsx)("td",{children:(0,A.jsx)("small",{children:e.error_message||"Unknown error"})}),(0,A.jsx)("td",{children:(0,A.jsx)(n.A,{bg:"danger",children:e.count})})]},s))})]}):(0,A.jsx)("p",{className:"text-success",children:"No recent errors! \ud83c\udf89"})})]})})]}),!1]})}}}]);
//# sourceMappingURL=147.6176f0e8.chunk.js.map