"use strict";(self.webpackChunkkho_mvg_client=self.webpackChunkkho_mvg_client||[]).push([[764,805],{730:(e,s,n)=>{n.d(s,{A:()=>t});const a="http://localhost:5001/api";const t=new class{async getAuthHeaders(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const s=localStorage.getItem("token");s?console.log("\u2705 Token found, length:",s.length):console.warn("\u26a0\ufe0f No token found in localStorage");const n={"Content-Type":"application/json",Authorization:"Bearer ".concat(s)};return e&&(n["Cache-Control"]="no-cache",n.Pragma="no-cache"),n}async handleResponse(e){const s=await e.json();if(!e.ok)throw console.error("\u274c CustomerService API Error:"),console.error("  Status:",e.status),console.error("  Status Text:",e.statusText),console.error("  Response Data:",s),400===e.status&&s.errors&&(console.error("  Validation Errors:"),s.errors.forEach(e=>{console.error("    - ".concat(e.path||e.param,": ").concat(e.msg))})),new Error(s.message||"HTTP error! status: ".concat(e.status));return s}async getCustomers(){const e=new URLSearchParams(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).toString(),s="".concat(a,"/customers").concat(e?"?".concat(e):""),n=await fetch(s,{method:"GET",headers:await this.getAuthHeaders(!0)});return this.handleResponse(n)}async getCustomer(e){const s=await fetch("".concat(a,"/customers/").concat(e),{method:"GET",headers:await this.getAuthHeaders()});return this.handleResponse(s)}async createCustomer(e){const s=await fetch("".concat(a,"/customers"),{method:"POST",headers:await this.getAuthHeaders(),body:JSON.stringify(e)});return this.handleResponse(s)}async updateCustomer(e,s){const n=await fetch("".concat(a,"/customers/").concat(e),{method:"PUT",headers:await this.getAuthHeaders(),body:JSON.stringify(s)});return this.handleResponse(n)}async deleteCustomer(e){const s=await fetch("".concat(a,"/customers/").concat(e),{method:"DELETE",headers:await this.getAuthHeaders()});return this.handleResponse(s)}async getCustomerContracts(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=new URLSearchParams(s?{status:s}:{}).toString(),t="".concat(a,"/customers/").concat(e,"/contracts").concat(n?"?".concat(n):""),c=await fetch(t,{method:"GET",headers:await this.getAuthHeaders()});return this.handleResponse(c)}async createContract(e){const s=await fetch("".concat(a,"/customers/contracts"),{method:"POST",headers:await this.getAuthHeaders(),body:JSON.stringify(e)});return this.handleResponse(s)}async getExpiringContracts(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;const s=await fetch("".concat(a,"/customers/contracts/expiring?days=").concat(e),{method:"GET",headers:await this.getAuthHeaders()});return this.handleResponse(s)}async getCustomerStats(){const e=await fetch("".concat(a,"/customers/stats"),{method:"GET",headers:await this.getAuthHeaders()});return this.handleResponse(e)}}},3519:(e,s,n)=>{n.d(s,{A:()=>m});var a=n(9379),t=n(45),c=n(8139),r=n.n(c),i=n(5043),l=n(7852),o=n(579);const h=["bsPrefix","fluid","as","className"],d=i.forwardRef((e,s)=>{let{bsPrefix:n,fluid:c=!1,as:i="div",className:d}=e,m=(0,t.A)(e,h);const u=(0,l.oU)(n,"container"),x="string"===typeof c?"-".concat(c):"-fluid";return(0,o.jsx)(i,(0,a.A)((0,a.A)({ref:s},m),{},{className:r()(d,c?"".concat(u).concat(x):u)}))});d.displayName="Container";const m=d},4196:(e,s,n)=>{n.d(s,{A:()=>m});var a=n(9379),t=n(45),c=n(8139),r=n.n(c),i=n(5043),l=n(7852),o=n(579);const h=["bsPrefix","className","striped","bordered","borderless","hover","size","variant","responsive"],d=i.forwardRef((e,s)=>{let{bsPrefix:n,className:c,striped:i,bordered:d,borderless:m,hover:u,size:x,variant:p,responsive:g}=e,j=(0,t.A)(e,h);const f=(0,l.oU)(n,"table"),v=r()(c,f,p&&"".concat(f,"-").concat(p),x&&"".concat(f,"-").concat(x),i&&"".concat(f,"-").concat("string"===typeof i?"striped-".concat(i):"striped"),d&&"".concat(f,"-bordered"),m&&"".concat(f,"-borderless"),u&&"".concat(f,"-hover")),A=(0,o.jsx)("table",(0,a.A)((0,a.A)({},j),{},{className:v,ref:s}));if(g){let e="".concat(f,"-responsive");return"string"===typeof g&&(e="".concat(e,"-").concat(g)),(0,o.jsx)("div",{className:e,children:A})}return A});d.displayName="Table";const m=d},4805:(e,s,n)=>{n.r(s),n.d(s,{default:()=>y});var a=n(9379),t=n(5043),c=n(4063),r=n(4282),i=n(8628),l=n(8602),o=n(3519),h=n(3722),d=n(2557),m=n(1072),u=n(4196),x=n(3216),p=n(5016),g=n(6471),j=n(2550),f=n(7764),v=n(730),A=n(579);const y=function(){const e=(0,x.Zp)(),{hasPermission:s}=(0,p.As)(),{showSuccess:n,showError:y}=(0,g.hN)(),[b,N]=(0,t.useState)(!0),[_,C]=(0,t.useState)([]),[w,k]=(0,t.useState)([]),[T,S]=(0,t.useState)(!1),[L,D]=(0,t.useState)(!1),[K,H]=(0,t.useState)(null),[B,E]=(0,t.useState)(!1),[G,M]=(0,t.useState)({page:1,limit:20,total:0,pages:0}),[I,P]=(0,t.useState)({search:"",customer_type:"",credit_rating:""}),R=(0,t.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;try{N(!0);const s=(0,a.A)({page:e,limit:G.limit},I);Object.keys(s).forEach(e=>{s[e]||delete s[e]});const n=await v.A.getCustomers(s);C(n.data.customers),k(n.data.customers),M(n.data.pagination)}catch(s){console.warn("Customer loading error:",s.message)}finally{N(!1)}},[I,G.limit,y]);(0,t.useEffect)(()=>{s("customer_read")&&R(G.page)},[s,R,G.page]),(0,t.useEffect)(()=>{R(G.page)},[]),(0,t.useEffect)(()=>{const e=setTimeout(()=>{1===G.page||M(e=>(0,a.A)((0,a.A)({},e),{},{page:1})),R(1)},500);return()=>clearTimeout(e)},[I]);const z=(e,s)=>{P(n=>(0,a.A)((0,a.A)({},n),{},{[e]:s}))},F=e=>{const s={A:{variant:"success",label:"A - T\u1ed1t"},B:{variant:"primary",label:"B - Kh\xe1"},C:{variant:"warning",label:"C - Trung b\xecnh"},D:{variant:"danger",label:"D - K\xe9m"}}[e]||{variant:"secondary",label:e};return(0,A.jsx)(c.A,{bg:s.variant,children:s.label})},V=e=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(e).replace("\u20ab","\u0111"),q=async e=>{try{E(!0);const s=(e=>{if(console.log("\ud83d\udd0d Raw form data received:",e),!e||"object"!==typeof e)throw console.error("\u274c Invalid form data structure:",e),new Error("Invalid form data received");const{personal:s={},companies:n=[]}=e,a=n[0]||{};console.log("\ud83d\udccb Form data breakdown:",{personal:s,primaryCompany:a,companiesLength:n.length});const t={name:a.company_name||s.full_name||"",full_name:s.full_name||"",representative_name:s.full_name||"",phone:s.phone||"",email:s.email||"",address:s.address||a.invoice_address||"",customer_type:s.customer_type||"individual",notes:s.notes||"",id_number:s.id_number||"",warehouse_purpose:a.warehouse_purpose||"",tax_code:a.tax_code||"",representative_phone:s.phone||"",representative_email:s.email||""};if(console.log("\ud83d\udcca Field mapping details:"),console.log("  personal.full_name \u2192",t.full_name,"& representative_name \u2192",t.representative_name),console.log("  personal.id_number \u2192",t.id_number),console.log("  personal.phone \u2192",t.phone),console.log("  personal.email \u2192",t.email),console.log("  personal.address \u2192",t.address),console.log("  primaryCompany.company_name \u2192",t.name),console.log("  primaryCompany.warehouse_purpose \u2192",t.warehouse_purpose),console.log("  primaryCompany.tax_code \u2192",t.tax_code),console.log("\u2705 Transformed API data:",t),!t.representative_name||!t.phone)throw console.error("\u274c Missing required fields:",{representative_name:t.representative_name,phone:t.phone}),new Error("Missing required fields: representative_name or phone");return t})(e);console.log("Transformed customer data:",s),K?(await v.A.updateCustomer(K.id,s),n("C\u1eadp nh\u1eadt kh\xe1ch h\xe0ng th\xe0nh c\xf4ng"),D(!1),console.log("\ud83d\udd04 Reloading customers list after update..."),await R(G.page),console.log("\u2705 Customers list reloaded successfully")):(await v.A.createCustomer(s),n("T\u1ea1o kh\xe1ch h\xe0ng m\u1edbi th\xe0nh c\xf4ng"),S(!1),await R(G.page)),H(null)}catch(s){throw s}finally{E(!1)}},X=_.reduce((e,s)=>e+s.monthly_revenue,0),O=_.filter(e=>e.active_contracts>0).length,U=_.length>0?X/_.length:0;return b?(0,A.jsx)(j.A,{text:"\u0110ang t\u1ea3i danh s\xe1ch kh\xe1ch h\xe0ng..."}):(0,A.jsxs)(o.A,{fluid:!0,className:"p-4",children:[(0,A.jsx)(m.A,{className:"mb-4",children:(0,A.jsx)(l.A,{children:(0,A.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,A.jsxs)("div",{children:[(0,A.jsx)("h2",{className:"mb-1",children:"Qu\u1ea3n l\xfd Kh\xe1ch h\xe0ng"}),(0,A.jsx)("p",{className:"text-muted mb-0",children:"Qu\u1ea3n l\xfd th\xf4ng tin kh\xe1ch h\xe0ng v\xe0 h\u1ee3p \u0111\u1ed3ng"})]}),s("customer_create")&&(0,A.jsxs)(r.A,{variant:"primary",onClick:()=>{s("customer_create")?(H(null),S(!0)):y("B\u1ea1n kh\xf4ng c\xf3 quy\u1ec1n t\u1ea1o kh\xe1ch h\xe0ng m\u1edbi")},children:[(0,A.jsx)("i",{className:"fas fa-plus me-2"}),"Th\xeam kh\xe1ch h\xe0ng"]})]})})}),(0,A.jsxs)(m.A,{className:"mb-4",children:[(0,A.jsx)(l.A,{md:3,className:"mb-3",children:(0,A.jsx)(i.A,{className:"border-0 shadow-sm",children:(0,A.jsx)(i.A.Body,{children:(0,A.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,A.jsxs)("div",{children:[(0,A.jsx)("h6",{className:"text-muted mb-1",children:"T\u1ed5ng kh\xe1ch h\xe0ng"}),(0,A.jsx)("h4",{className:"mb-0 text-primary",children:_.length})]}),(0,A.jsx)("i",{className:"fas fa-users fa-2x text-primary opacity-25"})]})})})}),(0,A.jsx)(l.A,{md:3,className:"mb-3",children:(0,A.jsx)(i.A,{className:"border-0 shadow-sm",children:(0,A.jsx)(i.A.Body,{children:(0,A.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,A.jsxs)("div",{children:[(0,A.jsx)("h6",{className:"text-muted mb-1",children:"\u0110ang ho\u1ea1t \u0111\u1ed9ng"}),(0,A.jsx)("h4",{className:"mb-0 text-success",children:O})]}),(0,A.jsx)("i",{className:"fas fa-user-check fa-2x text-success opacity-25"})]})})})}),(0,A.jsx)(l.A,{md:3,className:"mb-3",children:(0,A.jsx)(i.A,{className:"border-0 shadow-sm",children:(0,A.jsx)(i.A.Body,{children:(0,A.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,A.jsxs)("div",{children:[(0,A.jsx)("h6",{className:"text-muted mb-1",children:"T\u1ed5ng doanh thu/th\xe1ng"}),(0,A.jsx)("h4",{className:"mb-0 text-warning",children:V(X)})]}),(0,A.jsx)("i",{className:"fas fa-chart-line fa-2x text-warning opacity-25"})]})})})}),(0,A.jsx)(l.A,{md:3,className:"mb-3",children:(0,A.jsx)(i.A,{className:"border-0 shadow-sm",children:(0,A.jsx)(i.A.Body,{children:(0,A.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,A.jsxs)("div",{children:[(0,A.jsx)("h6",{className:"text-muted mb-1",children:"TB doanh thu/KH"}),(0,A.jsx)("h4",{className:"mb-0 text-info",children:V(U)})]}),(0,A.jsx)("i",{className:"fas fa-calculator fa-2x text-info opacity-25"})]})})})})]}),(0,A.jsx)(i.A,{className:"border-0 shadow-sm mb-4",children:(0,A.jsx)(i.A.Body,{children:(0,A.jsxs)(m.A,{children:[(0,A.jsx)(l.A,{md:4,children:(0,A.jsxs)(h.A.Group,{children:[(0,A.jsx)(h.A.Label,{children:"T\xecm ki\u1ebfm"}),(0,A.jsx)(h.A.Control,{type:"text",placeholder:"T\xecm theo m\xe3, t\xean, S\u0110T, email...",value:I.search,onChange:e=>z("search",e.target.value)})]})}),(0,A.jsx)(l.A,{md:4,children:(0,A.jsxs)(h.A.Group,{children:[(0,A.jsx)(h.A.Label,{children:"Lo\u1ea1i kh\xe1ch h\xe0ng"}),(0,A.jsxs)(h.A.Select,{value:I.customer_type,onChange:e=>z("customer_type",e.target.value),children:[(0,A.jsx)("option",{value:"",children:"T\u1ea5t c\u1ea3 lo\u1ea1i"}),(0,A.jsx)("option",{value:"company",children:"Doanh nghi\u1ec7p"}),(0,A.jsx)("option",{value:"individual",children:"C\xe1 nh\xe2n"})]})]})}),(0,A.jsx)(l.A,{md:4,children:(0,A.jsxs)(h.A.Group,{children:[(0,A.jsx)(h.A.Label,{children:"X\u1ebfp h\u1ea1ng t\xedn d\u1ee5ng"}),(0,A.jsxs)(h.A.Select,{value:I.credit_rating,onChange:e=>z("credit_rating",e.target.value),children:[(0,A.jsx)("option",{value:"",children:"T\u1ea5t c\u1ea3 x\u1ebfp h\u1ea1ng"}),(0,A.jsx)("option",{value:"A",children:"A - T\u1ed1t"}),(0,A.jsx)("option",{value:"B",children:"B - Kh\xe1"}),(0,A.jsx)("option",{value:"C",children:"C - Trung b\xecnh"}),(0,A.jsx)("option",{value:"D",children:"D - K\xe9m"})]})]})})]})})}),(0,A.jsxs)(i.A,{className:"border-0 shadow-sm",children:[(0,A.jsx)(i.A.Header,{className:"bg-white border-0",children:(0,A.jsxs)("h5",{className:"mb-0",children:[(0,A.jsx)("i",{className:"fas fa-list me-2"}),"Danh s\xe1ch kh\xe1ch h\xe0ng (",w.length,")"]})}),(0,A.jsx)(i.A.Body,{className:"p-0",children:(0,A.jsx)("div",{className:"table-responsive",children:(0,A.jsxs)(u.A,{hover:!0,className:"mb-0",children:[(0,A.jsx)("thead",{className:"bg-light",children:(0,A.jsxs)("tr",{children:[(0,A.jsx)("th",{children:"Kh\xe1ch h\xe0ng"}),(0,A.jsx)("th",{children:"Li\xean h\u1ec7"}),(0,A.jsx)("th",{children:"Lo\u1ea1i"}),(0,A.jsx)("th",{children:"X\u1ebfp h\u1ea1ng"}),(0,A.jsx)("th",{children:"H\u1ee3p \u0111\u1ed3ng"}),(0,A.jsx)("th",{children:"Doanh thu/th\xe1ng"}),(0,A.jsx)("th",{children:"Thao t\xe1c"})]})}),(0,A.jsx)("tbody",{children:w.length>0?w.map(t=>{return(0,A.jsxs)("tr",{children:[(0,A.jsx)("td",{children:(0,A.jsxs)("div",{children:[(0,A.jsx)("div",{className:"fw-bold",children:t.company_name||t.contact_person}),(0,A.jsx)("small",{className:"text-muted",children:t.customer_code}),t.company_name&&(0,A.jsx)("div",{children:(0,A.jsx)("small",{className:"text-muted",children:t.contact_person})})]})}),(0,A.jsx)("td",{children:(0,A.jsxs)("div",{children:[(0,A.jsxs)("div",{children:[(0,A.jsx)("i",{className:"fas fa-phone fa-sm me-1"}),t.phone]}),t.email&&(0,A.jsxs)("div",{children:[(0,A.jsx)("i",{className:"fas fa-envelope fa-sm me-1"}),(0,A.jsx)("small",{children:t.email})]}),(0,A.jsx)("div",{className:"text-muted",children:(0,A.jsx)("small",{children:t.address})})]})}),(0,A.jsx)("td",{children:(i=t.customer_type,"company"===i?(0,A.jsx)(c.A,{bg:"info",children:"Doanh nghi\u1ec7p"}):(0,A.jsx)(c.A,{bg:"secondary",children:"C\xe1 nh\xe2n"}))}),(0,A.jsx)("td",{children:F(t.credit_rating)}),(0,A.jsx)("td",{children:(0,A.jsxs)("div",{children:[(0,A.jsxs)("div",{children:[(0,A.jsx)("span",{className:"fw-medium text-success",children:t.active_contracts}),(0,A.jsxs)("span",{className:"text-muted",children:["/",t.total_contracts]})]}),(0,A.jsx)("small",{className:"text-muted",children:"Hi\u1ec7u l\u1ef1c/T\u1ed5ng"})]})}),(0,A.jsx)("td",{children:(0,A.jsx)("div",{className:"fw-bold text-success",children:V(t.monthly_revenue)})}),(0,A.jsx)("td",{children:(0,A.jsxs)("div",{className:"btn-group",children:[(0,A.jsx)(r.A,{variant:"outline-primary",size:"sm",onClick:()=>{return s=t.id,void e("/customers/".concat(s));var s},children:(0,A.jsx)("i",{className:"fas fa-eye"})}),s("customer_update")&&(0,A.jsx)(r.A,{variant:"outline-secondary",size:"sm",onClick:()=>(async e=>{if(s("customer_update"))try{E(!0),console.log("\ud83d\udd0d Loading full customer data including contracts...");const s=await v.A.getCustomer(e.id);console.log("\u2705 Full customer data loaded:",s.data);const n=(0,a.A)((0,a.A)({},s.data.customer),{},{contracts:s.data.contracts||[],statistics:s.data.statistics});console.log("\u2705 Merged customer data for form:",n),H(n),D(!0)}catch(n){console.error("\u274c Failed to load customer details:",n),H(e),D(!0)}finally{E(!1)}else y("B\u1ea1n kh\xf4ng c\xf3 quy\u1ec1n ch\u1ec9nh s\u1eeda kh\xe1ch h\xe0ng")})(t),title:"Ch\u1ec9nh s\u1eeda",children:(0,A.jsx)("i",{className:"fas fa-edit"})}),s("customer_delete")&&(0,A.jsx)(r.A,{variant:"outline-danger",size:"sm",className:"ms-1",onClick:()=>(async e=>{if(s("customer_delete")){if(window.confirm('B\u1ea1n c\xf3 ch\u1eafc ch\u1eafn mu\u1ed1n x\xf3a kh\xe1ch h\xe0ng "'.concat(e.company_name||e.contact_person,'"?')))try{await v.A.deleteCustomer(e.id),n("X\xf3a kh\xe1ch h\xe0ng th\xe0nh c\xf4ng"),R(G.page)}catch(a){y("Kh\xf4ng th\u1ec3 x\xf3a kh\xe1ch h\xe0ng: "+a.message)}}else y("B\u1ea1n kh\xf4ng c\xf3 quy\u1ec1n x\xf3a kh\xe1ch h\xe0ng")})(t),title:"X\xf3a kh\xe1ch h\xe0ng",children:(0,A.jsx)("i",{className:"fas fa-trash"})}),s("contract_create")&&(0,A.jsx)(r.A,{variant:"outline-success",size:"sm",onClick:()=>e("/contracts/create?customer=".concat(t.id)),title:"T\u1ea1o h\u1ee3p \u0111\u1ed3ng m\u1edbi",children:(0,A.jsx)("i",{className:"fas fa-file-contract"})})]})})]},t.id);var i}):(0,A.jsx)("tr",{children:(0,A.jsx)("td",{colSpan:7,className:"text-center py-4",children:(0,A.jsxs)("div",{className:"text-muted",children:[(0,A.jsx)("i",{className:"fas fa-search fa-2x mb-3"}),(0,A.jsx)("p",{children:"Kh\xf4ng t\xecm th\u1ea5y kh\xe1ch h\xe0ng n\xe0o ph\xf9 h\u1ee3p v\u1edbi b\u1ed9 l\u1ecdc"})]})})})})]})})})]}),(0,A.jsxs)(m.A,{className:"mt-4",children:[(0,A.jsx)(l.A,{md:6,children:(0,A.jsxs)(i.A,{className:"border-0 shadow-sm",children:[(0,A.jsx)(i.A.Header,{className:"bg-white border-0",children:(0,A.jsxs)("h6",{className:"mb-0",children:[(0,A.jsx)("i",{className:"fas fa-exclamation-triangle text-warning me-2"}),"Kh\xe1ch h\xe0ng c\u1ea7n ch\xfa \xfd"]})}),(0,A.jsxs)(i.A.Body,{children:[(0,A.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[(0,A.jsx)("span",{children:"X\u1ebfp h\u1ea1ng D (K\xe9m)"}),(0,A.jsx)(c.A,{bg:"danger",children:_.filter(e=>"D"===e.credit_rating).length})]}),(0,A.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[(0,A.jsx)("span",{children:"Kh\xf4ng c\xf3 h\u1ee3p \u0111\u1ed3ng hi\u1ec7u l\u1ef1c"}),(0,A.jsx)(c.A,{bg:"warning",children:_.filter(e=>0===e.active_contracts).length})]}),(0,A.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,A.jsx)("span",{children:"Doanh thu = 0"}),(0,A.jsx)(c.A,{bg:"secondary",children:_.filter(e=>0===e.monthly_revenue).length})]})]})]})}),(0,A.jsx)(l.A,{md:6,children:(0,A.jsxs)(i.A,{className:"border-0 shadow-sm",children:[(0,A.jsx)(i.A.Header,{className:"bg-white border-0",children:(0,A.jsxs)("h6",{className:"mb-0",children:[(0,A.jsx)("i",{className:"fas fa-chart-pie text-info me-2"}),"Th\u1ed1ng k\xea nhanh"]})}),(0,A.jsxs)(i.A.Body,{children:[(0,A.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[(0,A.jsx)("span",{children:"Doanh nghi\u1ec7p"}),(0,A.jsxs)(c.A,{bg:"info",children:[_.filter(e=>"company"===e.customer_type).length,(0,A.jsxs)("span",{className:"ms-1",children:["(",Math.round(_.filter(e=>"company"===e.customer_type).length/_.length*100),"%)"]})]})]}),(0,A.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[(0,A.jsx)("span",{children:"C\xe1 nh\xe2n"}),(0,A.jsxs)(c.A,{bg:"secondary",children:[_.filter(e=>"individual"===e.customer_type).length,(0,A.jsxs)("span",{className:"ms-1",children:["(",Math.round(_.filter(e=>"individual"===e.customer_type).length/_.length*100),"%)"]})]})]}),(0,A.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,A.jsx)("span",{children:"X\u1ebfp h\u1ea1ng A (T\u1ed1t)"}),(0,A.jsx)(c.A,{bg:"success",children:_.filter(e=>"A"===e.credit_rating).length})]})]})]})})]}),(0,A.jsxs)(d.A,{show:T,onHide:()=>S(!1),size:"xl",scrollable:!0,children:[(0,A.jsx)(d.A.Header,{closeButton:!0,children:(0,A.jsx)(d.A.Title,{children:"Th\xeam kh\xe1ch h\xe0ng m\u1edbi"})}),(0,A.jsx)(d.A.Body,{className:"p-0",children:(0,A.jsx)("div",{style:{maxHeight:"80vh",overflowY:"auto",padding:"1rem"},children:(0,A.jsx)(f.default,{customer:null,onSave:q,onCancel:()=>S(!1),isLoading:B})})})]}),(0,A.jsxs)(d.A,{show:L,onHide:()=>D(!1),size:"xl",scrollable:!0,children:[(0,A.jsx)(d.A.Header,{closeButton:!0,children:(0,A.jsx)(d.A.Title,{children:"Ch\u1ec9nh s\u1eeda kh\xe1ch h\xe0ng"})}),(0,A.jsx)(d.A.Body,{className:"p-0",children:(0,A.jsx)("div",{style:{maxHeight:"80vh",overflowY:"auto",padding:"1rem"},children:(0,A.jsx)(f.default,{customer:K,onSave:q,onCancel:()=>D(!1),isLoading:B})})})]})]})}},7764:(e,s,n)=>{n.r(s),n.d(s,{default:()=>f});var a=n(9379),t=n(5043),c=n(5328),r=n(326),i=n(4282),l=n(8628),o=n(1072),h=n(8602),d=n(3722),m=n(7994),u=n(1719),x=n(579);const p=function(e){let{data:s,errors:n,touched:t,onDataChange:c,onGenerateCode:r}=e;const p=e=>{const{name:n,value:t}=e.target,r=(0,a.A)((0,a.A)({},s),{},{[n]:t});c(r)};return(0,x.jsxs)(l.A,{children:[(0,x.jsx)(l.A.Header,{children:(0,x.jsxs)("h5",{className:"mb-0",children:[(0,x.jsx)("i",{className:"fas fa-user me-2"}),"Th\xf4ng tin c\xe1 nh\xe2n c\u01a1 b\u1ea3n"]})}),(0,x.jsxs)(l.A.Body,{children:[(0,x.jsxs)(o.A,{children:[(0,x.jsx)(h.A,{md:6,children:(0,x.jsxs)(d.A.Group,{className:"mb-3",children:[(0,x.jsx)(d.A.Label,{children:"Lo\u1ea1i kh\xe1ch h\xe0ng *"}),(0,x.jsxs)(d.A.Select,{name:"customer_type",value:s.customer_type,onChange:p,children:[(0,x.jsx)("option",{value:"individual",children:"C\xe1 nh\xe2n (CN)"}),(0,x.jsx)("option",{value:"company",children:"Doanh nghi\u1ec7p (DN)"})]}),(0,x.jsx)(d.A.Text,{className:"text-muted",children:"M\xe3 kh\xe1ch h\xe0ng s\u1ebd b\u1eaft \u0111\u1ea7u b\u1eb1ng CN (C\xe1 nh\xe2n) ho\u1eb7c DN (Doanh nghi\u1ec7p)"})]})}),(0,x.jsx)(h.A,{md:6,children:(0,x.jsxs)(d.A.Group,{className:"mb-3",children:[(0,x.jsx)(d.A.Label,{children:"M\xe3 kh\xe1ch h\xe0ng *"}),(0,x.jsxs)(m.A,{children:[(0,x.jsx)(d.A.Control,{type:"text",name:"customer_code",value:s.customer_code,onChange:p,placeholder:"VD: ".concat("individual"===s.customer_type?"CN":"DN","123456"),isInvalid:t.customer_code&&n.customer_code}),(0,x.jsx)(i.A,{variant:"outline-secondary",onClick:r,title:"T\u1ef1 \u0111\u1ed9ng t\u1ea1o m\xe3",children:(0,x.jsx)("i",{className:"fas fa-magic"})})]}),t.customer_code&&n.customer_code&&(0,x.jsx)("div",{className:"invalid-feedback d-block",children:n.customer_code}),(0,x.jsx)(d.A.Text,{className:"text-muted",children:"Format: 2 k\xfd t\u1ef1 ph\xe2n lo\u1ea1i + 6 k\xfd t\u1ef1 s\u1ed1 t\u1ef1 \u0111\u1ed9ng"})]})})]}),(0,x.jsxs)(o.A,{children:[(0,x.jsx)(h.A,{md:8,children:(0,x.jsxs)(d.A.Group,{className:"mb-3",children:[(0,x.jsx)(d.A.Label,{children:"H\u1ecd v\xe0 t\xean \u0111\u1ea7y \u0111\u1ee7 *"}),(0,x.jsx)(d.A.Control,{type:"text",name:"full_name",value:s.full_name,onChange:p,placeholder:"Nh\u1eadp h\u1ecd t\xean \u0111\u1ea7y \u0111\u1ee7",isInvalid:t.full_name&&n.full_name}),t.full_name&&n.full_name&&(0,x.jsx)("div",{className:"invalid-feedback",children:n.full_name})]})}),(0,x.jsx)(h.A,{md:4,children:(0,x.jsxs)(d.A.Group,{className:"mb-3",children:[(0,x.jsx)(d.A.Label,{children:"S\u1ed1 \u0111i\u1ec7n tho\u1ea1i *"}),(0,x.jsx)(d.A.Control,{type:"text",name:"phone",value:s.phone,onChange:p,placeholder:"0123456789",isInvalid:t.phone&&n.phone}),t.phone&&n.phone&&(0,x.jsx)("div",{className:"invalid-feedback",children:n.phone})]})})]}),(0,x.jsxs)(o.A,{children:[(0,x.jsx)(h.A,{md:6,children:(0,x.jsxs)(d.A.Group,{className:"mb-3",children:[(0,x.jsx)(d.A.Label,{children:"Email"}),(0,x.jsx)(d.A.Control,{type:"email",name:"email",value:s.email,onChange:p,placeholder:"email@example.com",isInvalid:t.email&&n.email}),t.email&&n.email&&(0,x.jsx)("div",{className:"invalid-feedback",children:n.email})]})}),(0,x.jsx)(h.A,{md:6,children:(0,x.jsxs)(d.A.Group,{className:"mb-3",children:[(0,x.jsx)(d.A.Label,{children:"CMND/CCCD"}),(0,x.jsx)(d.A.Control,{type:"text",name:"id_number",value:s.id_number,onChange:p,placeholder:"S\u1ed1 CMND/CCCD",isInvalid:t.id_number&&n.id_number}),t.id_number&&n.id_number&&(0,x.jsx)("div",{className:"invalid-feedback",children:n.id_number})]})})]}),(0,x.jsxs)(d.A.Group,{className:"mb-3",children:[(0,x.jsx)(d.A.Label,{children:"\u0110\u1ecba ch\u1ec9 li\xean h\u1ec7"}),(0,x.jsx)(d.A.Control,{as:"textarea",rows:2,name:"address",value:s.address,onChange:p,placeholder:"\u0110\u1ecba ch\u1ec9 \u0111\u1ea7y \u0111\u1ee7 (s\u1ed1 nh\xe0, \u0111\u01b0\u1eddng, ph\u01b0\u1eddng/x\xe3, qu\u1eadn/huy\u1ec7n, t\u1ec9nh/th\xe0nh)"})]}),(0,x.jsxs)(d.A.Group,{className:"mb-3",children:[(0,x.jsx)(d.A.Label,{children:"Ghi ch\xfa"}),(0,x.jsx)(d.A.Control,{as:"textarea",rows:3,name:"notes",value:s.notes,onChange:p,placeholder:"Ghi ch\xfa th\xeam v\u1ec1 kh\xe1ch h\xe0ng..."})]}),"individual"===s.customer_type&&(0,x.jsxs)(u.A,{variant:"info",children:[(0,x.jsx)("i",{className:"fas fa-info-circle me-2"}),(0,x.jsx)("strong",{children:"L\u01b0u \xfd cho kh\xe1ch h\xe0ng c\xe1 nh\xe2n:"})," M\u1ed9t c\xe1 nh\xe2n c\xf3 th\u1ec3 thu\xea kho th\xf4ng qua nhi\u1ec1u c\xf4ng ty kh\xe1c nhau. Vui l\xf2ng \u0111i\u1ec1n th\xf4ng tin c\xf4ng ty \u1edf tab ti\u1ebfp theo."]})]})]})};var g=n(4063);const j=function(e){let{companies:s,errors:n,touched:t,onCompaniesChange:c}=e;const r=(e,n,t)=>{const r=[...s];r[e]=(0,a.A)((0,a.A)({},r[e]),{},{[n]:t}),c(r)},m=e=>e.trim()?/^[0-9]{10}(-[0-9]{3})?$/.test(e)?"":"M\xe3 s\u1ed1 thu\u1ebf ph\u1ea3i c\xf3 10 s\u1ed1 ho\u1eb7c 10 s\u1ed1 + 3 s\u1ed1 m\xe3 chi nh\xe1nh (VD: 0123456789 ho\u1eb7c 0123456789-001)":"M\xe3 s\u1ed1 thu\u1ebf l\xe0 b\u1eaft bu\u1ed9c",p=["Kho h\xe0ng h\xf3a t\u1ed5ng h\u1ee3p","Kho nguy\xean li\u1ec7u s\u1ea3n xu\u1ea5t","Kho th\xe0nh ph\u1ea9m","Kho ph\u1ee5 t\xf9ng, linh ki\u1ec7n","Kho thi\u1ebft b\u1ecb, m\xe1y m\xf3c","Kho h\xe0ng \u0111i\u1ec7n t\u1eed","Kho h\xe0ng th\u1eddi trang","Kho h\xe0ng th\u1ef1c ph\u1ea9m","Kho h\xe0ng d\u01b0\u1ee3c ph\u1ea9m","Kho h\xe0ng h\xf3a ch\u1ea5t","Kho v\u0103n ph\xf2ng ph\u1ea9m","Kho t\xe0i li\u1ec7u, h\u1ed3 s\u01a1","Kh\xe1c"];return(0,x.jsxs)("div",{children:[(0,x.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[(0,x.jsxs)("h5",{className:"mb-0",children:[(0,x.jsx)("i",{className:"fas fa-building me-2"}),"Th\xf4ng tin c\xf4ng ty (",s.length,")"]}),(0,x.jsxs)(i.A,{variant:"outline-primary",size:"sm",onClick:()=>{const e={id:null,tax_code:"",company_name:"",invoice_address:"",warehouse_purpose:"",is_primary:0===s.length};c([...s,e])},children:[(0,x.jsx)("i",{className:"fas fa-plus me-2"}),"Th\xeam c\xf4ng ty"]})]}),(0,x.jsxs)(u.A,{variant:"info",className:"mb-3",children:[(0,x.jsx)("i",{className:"fas fa-info-circle me-2"}),(0,x.jsx)("strong",{children:"L\u01b0u \xfd:"})," M\u1ed9t c\xe1 nh\xe2n c\xf3 th\u1ec3 thu\xea nhi\u1ec1u kho b\u1eb1ng nhi\u1ec1u c\xf4ng ty kh\xe1c nhau. M\u1ed7i c\xf4ng ty s\u1ebd c\xf3 th\xf4ng tin ri\xeang \u0111\u1ec3 xu\u1ea5t h\xf3a \u0111\u01a1n v\xe0 k\xfd h\u1ee3p \u0111\u1ed3ng."]}),s.map((e,n)=>(0,x.jsxs)(l.A,{className:"mb-3",children:[(0,x.jsxs)(l.A.Header,{className:"d-flex justify-content-between align-items-center",children:[(0,x.jsxs)("div",{children:[(0,x.jsxs)("strong",{children:["C\xf4ng ty ",n+1]}),e.is_primary&&(0,x.jsx)(g.A,{bg:"primary",className:"ms-2",children:"C\xf4ng ty ch\xednh"})]}),(0,x.jsxs)("div",{children:[!e.is_primary&&s.length>1&&(0,x.jsx)(i.A,{variant:"outline-success",size:"sm",className:"me-2",onClick:()=>(e=>{const n=s.map((s,n)=>(0,a.A)((0,a.A)({},s),{},{is_primary:n===e}));c(n)})(n),title:"\u0110\u1eb7t l\xe0m c\xf4ng ty ch\xednh",children:(0,x.jsx)("i",{className:"fas fa-star"})}),s.length>1&&(0,x.jsx)(i.A,{variant:"outline-danger",size:"sm",onClick:()=>(e=>{if(s.length<=1)alert("Ph\u1ea3i c\xf3 \xedt nh\u1ea5t m\u1ed9t c\xf4ng ty");else if(window.confirm("B\u1ea1n c\xf3 ch\u1eafc ch\u1eafn mu\u1ed1n x\xf3a c\xf4ng ty n\xe0y?")){const n=s.filter((s,n)=>n!==e);s[e].is_primary&&n.length>0&&(n[0].is_primary=!0),c(n)}})(n),title:"X\xf3a c\xf4ng ty",children:(0,x.jsx)("i",{className:"fas fa-trash"})})]})]}),(0,x.jsxs)(l.A.Body,{children:[(0,x.jsxs)(o.A,{children:[(0,x.jsx)(h.A,{md:6,children:(0,x.jsxs)(d.A.Group,{className:"mb-3",children:[(0,x.jsx)(d.A.Label,{children:"M\xe3 s\u1ed1 thu\u1ebf *"}),(0,x.jsx)(d.A.Control,{type:"text",value:e.tax_code,onChange:e=>r(n,"tax_code",e.target.value),placeholder:"0123456789 ho\u1eb7c 0123456789-001",isInvalid:m(e.tax_code)}),(0,x.jsx)(d.A.Text,{className:"text-muted",children:"10 s\u1ed1 cho tr\u1ee5 s\u1edf ch\xednh, th\xeam -001, -002... cho chi nh\xe1nh"}),m(e.tax_code)&&(0,x.jsx)("div",{className:"invalid-feedback d-block",children:m(e.tax_code)})]})}),(0,x.jsx)(h.A,{md:6,children:(0,x.jsxs)(d.A.Group,{className:"mb-3",children:[(0,x.jsx)(d.A.Label,{children:"T\xean c\xf4ng ty *"}),(0,x.jsx)(d.A.Control,{type:"text",value:e.company_name,onChange:e=>r(n,"company_name",e.target.value),placeholder:"T\xean c\xf4ng ty \u0111\u1ea7y \u0111\u1ee7",isInvalid:!e.company_name.trim()}),!e.company_name.trim()&&(0,x.jsx)("div",{className:"invalid-feedback d-block",children:"T\xean c\xf4ng ty l\xe0 b\u1eaft bu\u1ed9c"})]})})]}),(0,x.jsxs)(d.A.Group,{className:"mb-3",children:[(0,x.jsx)(d.A.Label,{children:"\u0110\u1ecba ch\u1ec9 xu\u1ea5t h\xf3a \u0111\u01a1n *"}),(0,x.jsx)(d.A.Control,{as:"textarea",rows:2,value:e.invoice_address,onChange:e=>r(n,"invoice_address",e.target.value),placeholder:"\u0110\u1ecba ch\u1ec9 \u0111\u1ea7y \u0111\u1ee7 \u0111\u1ec3 xu\u1ea5t h\xf3a \u0111\u01a1n VAT",isInvalid:!e.invoice_address.trim()}),!e.invoice_address.trim()&&(0,x.jsx)("div",{className:"invalid-feedback d-block",children:"\u0110\u1ecba ch\u1ec9 xu\u1ea5t h\xf3a \u0111\u01a1n l\xe0 b\u1eaft bu\u1ed9c"})]}),(0,x.jsxs)(d.A.Group,{className:"mb-3",children:[(0,x.jsx)(d.A.Label,{children:"M\u1ee5c \u0111\xedch s\u1eed d\u1ee5ng kho *"}),(0,x.jsxs)(d.A.Select,{value:e.warehouse_purpose,onChange:e=>r(n,"warehouse_purpose",e.target.value),isInvalid:!e.warehouse_purpose,children:[(0,x.jsx)("option",{value:"",children:"-- Ch\u1ecdn m\u1ee5c \u0111\xedch s\u1eed d\u1ee5ng --"}),p.map(e=>(0,x.jsx)("option",{value:e,children:e},e))]}),!e.warehouse_purpose&&(0,x.jsx)("div",{className:"invalid-feedback d-block",children:"Vui l\xf2ng ch\u1ecdn m\u1ee5c \u0111\xedch s\u1eed d\u1ee5ng kho"}),(0,x.jsx)(d.A.Text,{className:"text-muted",children:"Th\xf4ng tin n\xe0y s\u1ebd \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng trong h\u1ee3p \u0111\u1ed3ng thu\xea kho"})]})]})]},n)),0===s.length&&(0,x.jsxs)(u.A,{variant:"warning",children:[(0,x.jsx)("i",{className:"fas fa-exclamation-triangle me-2"}),"Ch\u01b0a c\xf3 th\xf4ng tin c\xf4ng ty n\xe0o. Vui l\xf2ng th\xeam \xedt nh\u1ea5t m\u1ed9t c\xf4ng ty \u0111\u1ec3 ti\u1ebfp t\u1ee5c."]})]})};const f=function(e){let{customer:s=null,onSave:n,onCancel:l,isLoading:o=!1}=e;const[h,d]=(0,t.useState)("personal"),[m,u]=(0,t.useState)({personal:{customer_code:"",customer_type:"individual",full_name:"",phone:"",email:"",address:"",id_number:"",notes:""},companies:[{id:null,tax_code:"",company_name:"",invoice_address:"",warehouse_purpose:"",is_primary:!0}]}),[g]=(0,t.useState)({}),[f]=(0,t.useState)({});return(0,t.useEffect)(()=>{s?(console.log("\ud83d\udd0d Loading customer data for edit:",s),u({personal:{customer_code:s.customer_code||"",customer_type:s.customer_type||"individual",full_name:s.representative_name||s.name||"",phone:s.phone||"",email:s.email||"",address:s.address||"",id_number:s.id_number||"",notes:s.notes||""},companies:[{id:null,tax_code:s.tax_code||"",company_name:s.name||"",invoice_address:s.address||"",warehouse_purpose:s.warehouse_purpose||"",is_primary:!0}]}),console.log("\u2705 Form data populated for customer:",s.customer_code)):console.log("\ud83c\udd95 Creating new customer - using default form structure")},[s]),(0,x.jsxs)("div",{children:[(0,x.jsxs)(c.A.Container,{activeKey:h,onSelect:e=>d(e),children:[(0,x.jsxs)(r.A,{variant:"tabs",className:"mb-3",children:[(0,x.jsx)(r.A.Item,{children:(0,x.jsxs)(r.A.Link,{eventKey:"personal",children:[(0,x.jsx)("i",{className:"fas fa-user me-2"}),"Th\xf4ng tin c\u01a1 b\u1ea3n"]})}),(0,x.jsx)(r.A.Item,{children:(0,x.jsxs)(r.A.Link,{eventKey:"company",children:[(0,x.jsx)("i",{className:"fas fa-building me-2"}),"Th\xf4ng tin c\xf4ng ty"]})})]}),(0,x.jsxs)(c.A.Content,{children:[(0,x.jsx)(c.A.Pane,{eventKey:"personal",children:(0,x.jsx)(p,{data:m.personal,errors:g,touched:f,onDataChange:e=>u(s=>(0,a.A)((0,a.A)({},s),{},{personal:e})),onGenerateCode:()=>{const e="individual"===m.personal.customer_type?"CN":"DN",s=Date.now().toString(),n=Math.floor(1e4*Math.random()).toString().padStart(4,"0"),t=(s.slice(-2)+n).slice(0,6),c="".concat(e).concat(t);u(e=>(0,a.A)((0,a.A)({},e),{},{personal:(0,a.A)((0,a.A)({},e.personal),{},{customer_code:c})}))}})}),(0,x.jsx)(c.A.Pane,{eventKey:"company",children:(0,x.jsx)(j,{companies:m.companies,errors:g,touched:f,onCompaniesChange:e=>u(s=>(0,a.A)((0,a.A)({},s),{},{companies:e}))})})]})]}),(0,x.jsxs)("div",{className:"d-flex justify-content-between mt-4",children:[(0,x.jsxs)(i.A,{variant:"outline-secondary",onClick:l,disabled:o,children:[(0,x.jsx)("i",{className:"fas fa-times me-2"}),"H\u1ee7y b\u1ecf"]}),(0,x.jsxs)("div",{children:["personal"!==h&&(0,x.jsxs)(i.A,{variant:"outline-primary",className:"me-2",onClick:()=>d("personal"),children:[(0,x.jsx)("i",{className:"fas fa-arrow-left me-2"}),"Quay l\u1ea1i"]}),(0,x.jsx)(i.A,{variant:"success",onClick:()=>{try{if("function"!==typeof n)throw new Error("onSave is not a function");n(m)}catch(e){console.error("\u274c CustomerFormTabs onClick error:",e),alert("Error: "+e.message)}},disabled:o,size:"lg",children:o?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("span",{className:"spinner-border spinner-border-sm me-2"}),"\u0110ang l\u01b0u..."]}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("i",{className:"fas fa-save me-2"}),s?"C\u1eadp nh\u1eadt":"L\u01b0u th\xf4ng tin"]})})]})]})]})}}}]);
//# sourceMappingURL=805.0cfd44f8.chunk.js.map