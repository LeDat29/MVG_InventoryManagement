{"ast":null,"code":"import _objectSpread from\"C:/Users/Admin/Documents/GitHub/MVG_InventoryManagement/KinhDoanh/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";/**\r\n * Contract Manager - Quản lý hợp đồng chính\r\n */import React,{useState,useEffect,useCallback}from'react';import{Container,Row,Col,Card,Button,Table,Badge,Form,Modal,Tabs,Tab,Dropdown,OverlayTrigger,Tooltip}from'react-bootstrap';import{useAuth}from'../../contexts/AuthContext';import{useNotification}from'../../contexts/NotificationContext';import LoadingSpinner from'../Common/LoadingSpinner';import ContractCreator from'./ContractCreator';import contractService from'../../services/contractService';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ContractManager=_ref=>{let{initialOpenCreate=false,initialCustomerId=''}=_ref;const{hasPermission}=useAuth();const{showSuccess,showError}=useNotification();const[loading,setLoading]=useState(true);const[contracts,setContracts]=useState([]);const[filteredContracts,setFilteredContracts]=useState([]);const[showCreateModal,setShowCreateModal]=useState(!!initialOpenCreate);const[selectedContract,setSelectedContract]=useState(null);const[selectedRowCustomerId,setSelectedRowCustomerId]=useState('');const[showDetailModal,setShowDetailModal]=useState(false);const[renderError,setRenderError]=useState(null);const[filters,setFilters]=useState({search:'',status:'',workflow_stage:'',start_date_from:'',start_date_to:''});const[pagination,setPagination]=useState({page:1,limit:20,total:0,pages:0});// Contract statuses with colors\nconst contractStatuses={draft:{label:'Bản nháp',variant:'secondary'},review:{label:'Đang xem xét',variant:'info'},approved:{label:'Đã duyệt',variant:'success'},signed:{label:'Đã ký',variant:'primary'},active:{label:'Đang hiệu lực',variant:'success'},expired:{label:'Hết hạn',variant:'warning'},terminated:{label:'Chấm dứt',variant:'danger'},cancelled:{label:'Hủy bỏ',variant:'dark'}};const workflowStages={preparation:{label:'Chuẩn bị',icon:'fas fa-edit'},legal_review:{label:'Xem xét pháp lý',icon:'fas fa-balance-scale'},approval:{label:'Phê duyệt',icon:'fas fa-check-circle'},signing:{label:'Ký kết',icon:'fas fa-signature'},execution:{label:'Thực thi',icon:'fas fa-play-circle'}};// Load contracts\nconst loadContracts=useCallback(async function(){let page=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;try{setLoading(true);const params=_objectSpread({page:page.toString(),limit:pagination.limit.toString()},filters);// Remove empty filters\nObject.keys(params).forEach(key=>{if(!params[key])delete params[key];});const response=await contractService.getContracts(params);if(response&&response.success){const contractsData=Array.isArray(response.data.contracts)?response.data.contracts:[];const paginationData=response.data.pagination||{page:1,limit:20,total:contractsData.length,pages:1};setContracts(contractsData);setFilteredContracts(contractsData);setPagination(paginationData);}else{showError(response.message||'Không thể tải danh sách hợp đồng');}}catch(error){console.warn('Contract loading error:',(error===null||error===void 0?void 0:error.message)||error);// showError('Lỗi kết nối: ' + error.message);\n}finally{setLoading(false);}},[filters,pagination.limit,showError]);useEffect(()=>{if(hasPermission('contract_read')){loadContracts();}},[hasPermission,loadContracts,pagination.page]);// Handle filter changes\nuseEffect(()=>{// Debounce search to avoid too many API calls\nconst timeoutId=setTimeout(()=>{if(pagination.page===1){loadContracts(1);}else{setPagination(prev=>_objectSpread(_objectSpread({},prev),{},{page:1}));loadContracts(1);}},500);return()=>clearTimeout(timeoutId);},[filters]);// Format currency\nconst formatCurrency=amount=>{return new Intl.NumberFormat('vi-VN',{style:'currency',currency:'VND'}).format(amount);};// Calculate contract value\n// const calculateContractValue = (contract) => {\n//   const startDate = new Date(contract.start_date);\n//   const endDate = new Date(contract.end_date);\n//   const months = (endDate.getFullYear() - startDate.getFullYear()) * 12 + \n//                  (endDate.getMonth() - startDate.getMonth());\n//   return contract.rental_price * months;\n// };\n// Handle contract status change\nconst handleStatusChange=async(contractId,newStatus,newStage)=>{try{var _contractStatuses$new;const statusData={status:newStatus,workflow_stage:newStage,comment:\"Chuy\\u1EC3n tr\\u1EA1ng th\\xE1i sang \".concat((_contractStatuses$new=contractStatuses[newStatus])===null||_contractStatuses$new===void 0?void 0:_contractStatuses$new.label)};const response=await contractService.updateContractStatus(contractId,statusData);if(response.success){showSuccess('Cập nhật trạng thái thành công');loadContracts(pagination.page);}else{showError(response.message||'Không thể cập nhật trạng thái');}}catch(error){showError('Lỗi kết nối: '+error.message);}};// View contract details\nconst viewContractDetails=async contractId=>{try{const response=await contractService.getContract(contractId);if(response.success){setSelectedContract(response.data);setShowDetailModal(true);}else{showError(response.message||'Không thể tải chi tiết hợp đồng');}}catch(error){showError('Lỗi kết nối: '+error.message);}};if(!hasPermission('contract_read')){return/*#__PURE__*/_jsx(Container,{className:\"mt-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-warning\",children:\"B\\u1EA1n kh\\xF4ng c\\xF3 quy\\u1EC1n truy c\\u1EADp qu\\u1EA3n l\\xFD h\\u1EE3p \\u0111\\u1ED3ng.\"})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4\",children:[/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsxs(Col,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-between align-items-center mb-4\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-file-contract me-2\"}),\"Qu\\u1EA3n l\\xFD h\\u1EE3p \\u0111\\u1ED3ng\"]}),hasPermission('contract_create')&&/*#__PURE__*/_jsxs(Button,{variant:\"primary\",onClick:()=>{try{const params=new URLSearchParams(window.location.search);params.set('open','create');if(selectedRowCustomerId)params.set('customer',selectedRowCustomerId);const newUrl=\"\".concat(window.location.pathname,\"?\").concat(params.toString());window.history.replaceState({},'',newUrl);}catch(e){}setShowCreateModal(true);},children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-plus me-2\"}),\"T\\u1EA1o h\\u1EE3p \\u0111\\u1ED3ng m\\u1EDBi\"]})]}),/*#__PURE__*/_jsxs(Card,{className:\"mb-4\",children:[/*#__PURE__*/_jsx(Card.Header,{children:/*#__PURE__*/_jsxs(\"h5\",{className:\"mb-0\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-filter me-2\"}),\"B\\u1ED9 l\\u1ECDc\"]})}),/*#__PURE__*/_jsx(Card.Body,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:3,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"T\\xECm ki\\u1EBFm\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",placeholder:\"S\\u1ED1 H\\u0110, t\\xEAn kh\\xE1ch h\\xE0ng...\",value:filters.search,onChange:e=>setFilters(prev=>_objectSpread(_objectSpread({},prev),{},{search:e.target.value}))})]})}),/*#__PURE__*/_jsx(Col,{md:2,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Tr\\u1EA1ng th\\xE1i\"}),/*#__PURE__*/_jsxs(Form.Select,{value:filters.status,onChange:e=>setFilters(prev=>_objectSpread(_objectSpread({},prev),{},{status:e.target.value})),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"T\\u1EA5t c\\u1EA3\"}),Object.entries(contractStatuses).map(_ref2=>{let[key,status]=_ref2;return/*#__PURE__*/_jsx(\"option\",{value:key,children:status.label},key);})]})]})}),/*#__PURE__*/_jsx(Col,{md:2,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Giai \\u0111o\\u1EA1n\"}),/*#__PURE__*/_jsxs(Form.Select,{value:filters.workflow_stage,onChange:e=>setFilters(prev=>_objectSpread(_objectSpread({},prev),{},{workflow_stage:e.target.value})),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"T\\u1EA5t c\\u1EA3\"}),Object.entries(workflowStages).map(_ref3=>{let[key,stage]=_ref3;return/*#__PURE__*/_jsx(\"option\",{value:key,children:stage.label},key);})]})]})}),/*#__PURE__*/_jsx(Col,{md:2,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"T\\u1EEB ng\\xE0y\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"date\",value:filters.start_date_from,onChange:e=>setFilters(prev=>_objectSpread(_objectSpread({},prev),{},{start_date_from:e.target.value}))})]})}),/*#__PURE__*/_jsx(Col,{md:2,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"\\u0110\\u1EBFn ng\\xE0y\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"date\",value:filters.start_date_to,onChange:e=>setFilters(prev=>_objectSpread(_objectSpread({},prev),{},{start_date_to:e.target.value}))})]})}),/*#__PURE__*/_jsx(Col,{md:1,className:\"d-flex align-items-end\",children:/*#__PURE__*/_jsx(Button,{variant:\"outline-secondary\",onClick:()=>setFilters({search:'',status:'',workflow_stage:'',start_date_from:'',start_date_to:''}),children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-undo\"})})})]})})]}),/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsxs(Card.Header,{className:\"d-flex justify-content-between align-items-center\",children:[/*#__PURE__*/_jsxs(\"h5\",{className:\"mb-0\",children:[\"Danh s\\xE1ch h\\u1EE3p \\u0111\\u1ED3ng (\",pagination.total,\")\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex gap-2\",children:[/*#__PURE__*/_jsxs(Button,{variant:\"outline-primary\",size:\"sm\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-download me-2\"}),\"Xu\\u1EA5t Excel\"]}),/*#__PURE__*/_jsx(Button,{variant:\"outline-secondary\",size:\"sm\",onClick:()=>loadContracts(pagination.page),children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-sync-alt\"})})]})]}),/*#__PURE__*/_jsx(Card.Body,{className:\"p-0\",children:loading?/*#__PURE__*/_jsx(\"div\",{className:\"text-center p-4\",children:/*#__PURE__*/_jsx(LoadingSpinner,{})}):renderError?/*#__PURE__*/_jsxs(\"div\",{className:\"p-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"alert alert-danger\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"L\\u1ED7i hi\\u1EC3n th\\u1ECB danh s\\xE1ch h\\u1EE3p \\u0111\\u1ED3ng:\"}),/*#__PURE__*/_jsx(\"div\",{children:String(renderError)})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-muted\",children:\"Vui l\\xF2ng t\\u1EA3i l\\u1EA1i trang ho\\u1EB7c li\\xEAn h\\u1EC7 admin.\"})]}):/*#__PURE__*/_jsxs(Table,{responsive:true,hover:true,className:\"mb-0\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"table-light\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"S\\u1ED1 h\\u1EE3p \\u0111\\u1ED3ng\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Kh\\xE1ch h\\xE0ng\"}),/*#__PURE__*/_jsx(\"th\",{children:\"D\\u1EF1 \\xE1n\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Di\\u1EC7n t\\xEDch\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Gi\\xE1 thu\\xEA/th\\xE1ng\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Th\\u1EDDi h\\u1EA1n\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Tr\\u1EA1ng th\\xE1i\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Giai \\u0111o\\u1EA1n\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Ng\\u01B0\\u1EDDi ph\\u1EE5 tr\\xE1ch\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Thao t\\xE1c\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:(()=>{try{return(filteredContracts||[]).map(contract=>{var _contract$warehouse_a,_contract$rental_pric,_contract$rental_pric2,_contractStatuses$con,_contractStatuses$con2,_workflowStages$contr,_workflowStages$contr2;return/*#__PURE__*/_jsxs(\"tr\",{className:String(selectedRowCustomerId)===String(contract.customer_id)?'table-active':'',onClick:()=>setSelectedRowCustomerId(contract.customer_id),children:[/*#__PURE__*/_jsxs(\"td\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:contract.contract_number}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"small\",{className:\"text-muted\",children:contract.created_at?new Date(contract.created_at).toLocaleDateString('vi-VN'):''})]}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:contract.customer_company_name||contract.company_name}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"small\",{className:\"text-muted\",children:contract.customer_name})]})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:contract.project_name||'Chưa phân bổ'}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"small\",{className:\"text-muted\",children:contract.warehouse_location})]})}),/*#__PURE__*/_jsxs(\"td\",{children:[(_contract$warehouse_a=contract.warehouse_area)!==null&&_contract$warehouse_a!==void 0?_contract$warehouse_a:'N/A',\" m\\xB2\"]}),/*#__PURE__*/_jsxs(\"td\",{children:[formatCurrency((_contract$rental_pric=contract.rental_price)!==null&&_contract$rental_pric!==void 0?_contract$rental_pric:0),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"small\",{className:\"text-muted\",children:contract.warehouse_area?formatCurrency(((_contract$rental_pric2=contract.rental_price)!==null&&_contract$rental_pric2!==void 0?_contract$rental_pric2:0)/contract.warehouse_area)+'/m²':'N/A'})]}),/*#__PURE__*/_jsxs(\"td\",{children:[contract.start_date?new Date(contract.start_date).toLocaleDateString('vi-VN'):'',/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"small\",{className:\"text-muted\",children:[\"\\u2192 \",contract.end_date?new Date(contract.end_date).toLocaleDateString('vi-VN'):'']})]}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(Badge,{bg:((_contractStatuses$con=contractStatuses[contract.status])===null||_contractStatuses$con===void 0?void 0:_contractStatuses$con.variant)||'secondary',children:((_contractStatuses$con2=contractStatuses[contract.status])===null||_contractStatuses$con2===void 0?void 0:_contractStatuses$con2.label)||contract.status})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"\".concat((_workflowStages$contr=workflowStages[contract.workflow_stage])===null||_workflowStages$contr===void 0?void 0:_workflowStages$contr.icon,\" me-2\")}),/*#__PURE__*/_jsx(\"small\",{children:(_workflowStages$contr2=workflowStages[contract.workflow_stage])===null||_workflowStages$contr2===void 0?void 0:_workflowStages$contr2.label})]})}),/*#__PURE__*/_jsx(\"td\",{children:contract.assigned_to_name?/*#__PURE__*/_jsx(Badge,{bg:\"info\",children:contract.assigned_to_name}):/*#__PURE__*/_jsx(\"span\",{className:\"text-muted\",children:\"Ch\\u01B0a giao\"})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex gap-1\",children:[/*#__PURE__*/_jsx(OverlayTrigger,{overlay:/*#__PURE__*/_jsx(Tooltip,{children:\"Xem chi ti\\u1EBFt\"}),children:/*#__PURE__*/_jsx(Button,{variant:\"outline-primary\",size:\"sm\",onClick:()=>viewContractDetails(contract.id),children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-eye\"})})}),hasPermission('contract_update')&&/*#__PURE__*/_jsxs(Dropdown,{children:[/*#__PURE__*/_jsx(Dropdown.Toggle,{variant:\"outline-secondary\",size:\"sm\",id:\"dropdown-\".concat(contract.id),children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-cog\"})}),/*#__PURE__*/_jsxs(Dropdown.Menu,{children:[/*#__PURE__*/_jsxs(Dropdown.Item,{onClick:()=>handleStatusChange(contract.id,'review','legal_review'),children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-eye me-2\"}),\"G\\u1EEDi xem x\\xE9t\"]}),/*#__PURE__*/_jsxs(Dropdown.Item,{onClick:()=>handleStatusChange(contract.id,'approved','signing'),children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-check me-2\"}),\"Ph\\xEA duy\\u1EC7t\"]}),/*#__PURE__*/_jsxs(Dropdown.Item,{onClick:()=>handleStatusChange(contract.id,'signed','execution'),children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-signature me-2\"}),\"\\u0110\\xE3 k\\xFD\"]}),/*#__PURE__*/_jsx(Dropdown.Divider,{}),/*#__PURE__*/_jsxs(Dropdown.Item,{className:\"text-danger\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-trash me-2\"}),\"H\\u1EE7y b\\u1ECF\"]})]})]})]})})]},contract.id);});}catch(err){console.error('Render error in ContractManager:',err);setRenderError((err===null||err===void 0?void 0:err.message)||String(err));return null;}})()})]})}),pagination.pages>1&&/*#__PURE__*/_jsx(Card.Footer,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-between align-items-center\",children:[/*#__PURE__*/_jsxs(\"small\",{className:\"text-muted\",children:[\"Hi\\u1EC3n th\\u1ECB \",(pagination.page-1)*pagination.limit+1,\" - \",Math.min(pagination.page*pagination.limit,pagination.total),\"trong t\\u1ED5ng s\\u1ED1 \",pagination.total,\" h\\u1EE3p \\u0111\\u1ED3ng\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex gap-2\",children:[/*#__PURE__*/_jsx(Button,{variant:\"outline-secondary\",size:\"sm\",disabled:pagination.page===1,onClick:()=>setPagination(prev=>_objectSpread(_objectSpread({},prev),{},{page:prev.page-1})),children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-chevron-left\"})}),/*#__PURE__*/_jsxs(\"span\",{className:\"d-flex align-items-center px-3\",children:[\"Trang \",pagination.page,\" / \",pagination.pages]}),/*#__PURE__*/_jsx(Button,{variant:\"outline-secondary\",size:\"sm\",disabled:pagination.page===pagination.pages,onClick:()=>setPagination(prev=>_objectSpread(_objectSpread({},prev),{},{page:prev.page+1})),children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-chevron-right\"})})]})]})})]})]})}),/*#__PURE__*/_jsx(ContractCreator,{show:showCreateModal,initialCustomerId:selectedRowCustomerId||initialCustomerId,onHide:()=>setShowCreateModal(false),onSuccess:()=>{setShowCreateModal(false);loadContracts(pagination.page);}}),selectedContract&&/*#__PURE__*/_jsxs(Modal,{show:showDetailModal,onHide:()=>setShowDetailModal(false),size:\"xl\",scrollable:true,children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,children:/*#__PURE__*/_jsxs(Modal.Title,{children:[\"Chi ti\\u1EBFt h\\u1EE3p \\u0111\\u1ED3ng \",selectedContract.contract.contract_number]})}),/*#__PURE__*/_jsx(Modal.Body,{children:/*#__PURE__*/_jsx(ContractDetailView,{contract:selectedContract})})]})]});};// Contract Detail Component  \nconst ContractDetailView=_ref4=>{var _contract$documents,_contract$documents2,_contract$workflow_hi;let{contract}=_ref4;return/*#__PURE__*/_jsxs(Tabs,{defaultActiveKey:\"overview\",id:\"contract-detail-tabs\",children:[/*#__PURE__*/_jsx(Tab,{eventKey:\"overview\",title:\"T\\u1ED5ng quan\",children:/*#__PURE__*/_jsx(\"div\",{className:\"pt-3\",children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsxs(Col,{md:6,children:[/*#__PURE__*/_jsx(\"h5\",{children:\"Th\\xF4ng tin h\\u1EE3p \\u0111\\u1ED3ng\"}),/*#__PURE__*/_jsx(Table,{size:\"sm\",children:/*#__PURE__*/_jsxs(\"tbody\",{children:[/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"strong\",{children:\"S\\u1ED1 h\\u1EE3p \\u0111\\u1ED3ng:\"})}),/*#__PURE__*/_jsx(\"td\",{children:contract.contract.contract_number})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"strong\",{children:\"Ti\\xEAu \\u0111\\u1EC1:\"})}),/*#__PURE__*/_jsx(\"td\",{children:contract.contract.contract_title})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"strong\",{children:\"D\\u1EF1 \\xE1n:\"})}),/*#__PURE__*/_jsx(\"td\",{children:contract.contract.project_name||'Chưa phân bổ'})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"strong\",{children:\"Kho:\"})}),/*#__PURE__*/_jsx(\"td\",{children:contract.contract.warehouse_location})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"strong\",{children:\"Di\\u1EC7n t\\xEDch:\"})}),/*#__PURE__*/_jsxs(\"td\",{children:[contract.contract.warehouse_area,\" m\\xB2\"]})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"strong\",{children:\"Gi\\xE1 thu\\xEA:\"})}),/*#__PURE__*/_jsxs(\"td\",{children:[new Intl.NumberFormat('vi-VN').format(contract.contract.rental_price),\" VN\\u0110/th\\xE1ng\"]})]})]})})]}),/*#__PURE__*/_jsxs(Col,{md:6,children:[/*#__PURE__*/_jsx(\"h5\",{children:\"Th\\xF4ng tin kh\\xE1ch h\\xE0ng\"}),/*#__PURE__*/_jsx(Table,{size:\"sm\",children:/*#__PURE__*/_jsxs(\"tbody\",{children:[/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"strong\",{children:\"C\\xF4ng ty:\"})}),/*#__PURE__*/_jsx(\"td\",{children:contract.contract.customer_company_name})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"strong\",{children:\"Ng\\u01B0\\u1EDDi li\\xEAn h\\u1EC7:\"})}),/*#__PURE__*/_jsx(\"td\",{children:contract.contract.customer_name})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"strong\",{children:\"\\u0110i\\u1EC7n tho\\u1EA1i:\"})}),/*#__PURE__*/_jsx(\"td\",{children:contract.contract.customer_phone})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"strong\",{children:\"Email:\"})}),/*#__PURE__*/_jsx(\"td\",{children:contract.contract.customer_email})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"strong\",{children:\"M\\xE3 s\\u1ED1 thu\\u1EBF:\"})}),/*#__PURE__*/_jsx(\"td\",{children:contract.contract.tax_code})]})]})})]})]})})}),/*#__PURE__*/_jsx(Tab,{eventKey:\"documents\",title:\"T\\xE0i li\\u1EC7u (\".concat(((_contract$documents=contract.documents)===null||_contract$documents===void 0?void 0:_contract$documents.length)||0,\")\"),children:/*#__PURE__*/_jsx(\"div\",{className:\"pt-3\",children:((_contract$documents2=contract.documents)===null||_contract$documents2===void 0?void 0:_contract$documents2.length)>0?/*#__PURE__*/_jsxs(Table,{children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"T\\xEAn t\\xE0i li\\u1EC7u\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Lo\\u1EA1i\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Phi\\xEAn b\\u1EA3n\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Tr\\u1EA1ng th\\xE1i\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Ng\\xE0y t\\u1EA1o\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Thao t\\xE1c\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:contract.documents.map(doc=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:doc.document_name}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(Badge,{bg:\"info\",children:doc.category_name})}),/*#__PURE__*/_jsxs(\"td\",{children:[\"v\",doc.version]}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(Badge,{bg:doc.status==='final'?'success':doc.status==='draft'?'secondary':'warning',children:doc.status})}),/*#__PURE__*/_jsx(\"td\",{children:new Date(doc.created_at).toLocaleDateString('vi-VN')}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(Button,{variant:\"outline-primary\",size:\"sm\",children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-eye\"})})})]},doc.id))})]}):/*#__PURE__*/_jsx(\"div\",{className:\"text-center text-muted py-4\",children:\"Ch\\u01B0a c\\xF3 t\\xE0i li\\u1EC7u n\\xE0o\"})})}),/*#__PURE__*/_jsx(Tab,{eventKey:\"history\",title:\"L\\u1ECBch s\\u1EED\",children:/*#__PURE__*/_jsx(\"div\",{className:\"pt-3\",children:((_contract$workflow_hi=contract.workflow_history)===null||_contract$workflow_hi===void 0?void 0:_contract$workflow_hi.length)>0?/*#__PURE__*/_jsx(\"div\",{className:\"timeline\",children:contract.workflow_history.map(history=>/*#__PURE__*/_jsx(\"div\",{className:\"timeline-item mb-3\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0\",children:/*#__PURE__*/_jsx(\"div\",{className:\"rounded-circle bg-primary text-white d-flex align-items-center justify-content-center\",style:{width:'40px',height:'40px'},children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-user fa-sm\"})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-grow-1 ms-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-between\",children:[/*#__PURE__*/_jsx(\"h6\",{className:\"mb-1\",children:history.action}),/*#__PURE__*/_jsx(\"small\",{className:\"text-muted\",children:new Date(history.performed_at).toLocaleString('vi-VN')})]}),/*#__PURE__*/_jsx(\"p\",{className:\"mb-1\",children:history.comment}),/*#__PURE__*/_jsxs(\"small\",{className:\"text-muted\",children:[\"B\\u1EDFi: \",history.performed_by_name]})]})]})},history.id))}):/*#__PURE__*/_jsx(\"div\",{className:\"text-center text-muted py-4\",children:\"Ch\\u01B0a c\\xF3 l\\u1ECBch s\\u1EED n\\xE0o\"})})})]});};export default ContractManager;","map":{"version":3,"names":["React","useState","useEffect","useCallback","Container","Row","Col","Card","Button","Table","Badge","Form","Modal","Tabs","Tab","Dropdown","OverlayTrigger","Tooltip","useAuth","useNotification","LoadingSpinner","ContractCreator","contractService","jsx","_jsx","jsxs","_jsxs","ContractManager","_ref","initialOpenCreate","initialCustomerId","hasPermission","showSuccess","showError","loading","setLoading","contracts","setContracts","filteredContracts","setFilteredContracts","showCreateModal","setShowCreateModal","selectedContract","setSelectedContract","selectedRowCustomerId","setSelectedRowCustomerId","showDetailModal","setShowDetailModal","renderError","setRenderError","filters","setFilters","search","status","workflow_stage","start_date_from","start_date_to","pagination","setPagination","page","limit","total","pages","contractStatuses","draft","label","variant","review","approved","signed","active","expired","terminated","cancelled","workflowStages","preparation","icon","legal_review","approval","signing","execution","loadContracts","arguments","length","undefined","params","_objectSpread","toString","Object","keys","forEach","key","response","getContracts","success","contractsData","Array","isArray","data","paginationData","message","error","console","warn","timeoutId","setTimeout","prev","clearTimeout","formatCurrency","amount","Intl","NumberFormat","style","currency","format","handleStatusChange","contractId","newStatus","newStage","_contractStatuses$new","statusData","comment","concat","updateContractStatus","viewContractDetails","getContract","className","children","onClick","URLSearchParams","window","location","set","newUrl","pathname","history","replaceState","e","Header","Body","md","Group","Label","Control","type","placeholder","value","onChange","target","Select","entries","map","_ref2","_ref3","stage","size","String","responsive","hover","contract","_contract$warehouse_a","_contract$rental_pric","_contract$rental_pric2","_contractStatuses$con","_contractStatuses$con2","_workflowStages$contr","_workflowStages$contr2","customer_id","contract_number","created_at","Date","toLocaleDateString","customer_company_name","company_name","customer_name","project_name","warehouse_location","warehouse_area","rental_price","start_date","end_date","bg","assigned_to_name","overlay","id","Toggle","Menu","Item","Divider","err","Footer","Math","min","disabled","show","onHide","onSuccess","scrollable","closeButton","Title","ContractDetailView","_ref4","_contract$documents","_contract$documents2","_contract$workflow_hi","defaultActiveKey","eventKey","title","contract_title","customer_phone","customer_email","tax_code","documents","doc","document_name","category_name","version","workflow_history","width","height","action","performed_at","toLocaleString","performed_by_name"],"sources":["C:/Users/Admin/Documents/GitHub/MVG_InventoryManagement/KinhDoanh/client/src/components/Contracts/ContractManager.js"],"sourcesContent":["/**\r\n * Contract Manager - Quản lý hợp đồng chính\r\n */\r\n\r\nimport React, { useState, useEffect, useCallback } from 'react';\r\nimport { \r\n  Container, Row, Col, Card, Button, Table, Badge, Form, \r\n  Modal, Tabs, Tab, Dropdown, OverlayTrigger, Tooltip \r\n} from 'react-bootstrap';\r\nimport { useAuth } from '../../contexts/AuthContext';\r\nimport { useNotification } from '../../contexts/NotificationContext';\r\nimport LoadingSpinner from '../Common/LoadingSpinner';\r\nimport ContractCreator from './ContractCreator';\r\nimport contractService from '../../services/contractService';\r\n\r\nconst ContractManager = ({ initialOpenCreate = false, initialCustomerId = '' }) => {\r\n  const { hasPermission } = useAuth();\r\n  const { showSuccess, showError } = useNotification();\r\n  \r\n  const [loading, setLoading] = useState(true);\r\n  const [contracts, setContracts] = useState([]);\r\n  const [filteredContracts, setFilteredContracts] = useState([]);\r\n  const [showCreateModal, setShowCreateModal] = useState(!!initialOpenCreate);\r\n  const [selectedContract, setSelectedContract] = useState(null);\r\n  const [selectedRowCustomerId, setSelectedRowCustomerId] = useState('');\r\n  const [showDetailModal, setShowDetailModal] = useState(false);\r\n  const [renderError, setRenderError] = useState(null);\r\n\r\n  const [filters, setFilters] = useState({\r\n    search: '',\r\n    status: '',\r\n    workflow_stage: '',\r\n    start_date_from: '',\r\n    start_date_to: ''\r\n  });\r\n\r\n  const [pagination, setPagination] = useState({\r\n    page: 1,\r\n    limit: 20,\r\n    total: 0,\r\n    pages: 0\r\n  });\r\n\r\n  // Contract statuses with colors\r\n  const contractStatuses = {\r\n    draft: { label: 'Bản nháp', variant: 'secondary' },\r\n    review: { label: 'Đang xem xét', variant: 'info' },\r\n    approved: { label: 'Đã duyệt', variant: 'success' },\r\n    signed: { label: 'Đã ký', variant: 'primary' },\r\n    active: { label: 'Đang hiệu lực', variant: 'success' },\r\n    expired: { label: 'Hết hạn', variant: 'warning' },\r\n    terminated: { label: 'Chấm dứt', variant: 'danger' },\r\n    cancelled: { label: 'Hủy bỏ', variant: 'dark' }\r\n  };\r\n\r\n  const workflowStages = {\r\n    preparation: { label: 'Chuẩn bị', icon: 'fas fa-edit' },\r\n    legal_review: { label: 'Xem xét pháp lý', icon: 'fas fa-balance-scale' },\r\n    approval: { label: 'Phê duyệt', icon: 'fas fa-check-circle' },\r\n    signing: { label: 'Ký kết', icon: 'fas fa-signature' },\r\n    execution: { label: 'Thực thi', icon: 'fas fa-play-circle' }\r\n  };\r\n\r\n  // Load contracts\r\n  const loadContracts = useCallback(async (page = 1) => {\r\n    try {\r\n      setLoading(true);\r\n      const params = {\r\n        page: page.toString(),\r\n        limit: pagination.limit.toString(),\r\n        ...filters\r\n      };\r\n\r\n      // Remove empty filters\r\n      Object.keys(params).forEach(key => {\r\n        if (!params[key]) delete params[key];\r\n      });\r\n\r\n      const response = await contractService.getContracts(params);\r\n      \r\n      if (response && response.success) {\r\n        const contractsData = Array.isArray(response.data.contracts) ? response.data.contracts : [];\r\n        const paginationData = response.data.pagination || { page: 1, limit: 20, total: contractsData.length, pages: 1 };\r\n\r\n        setContracts(contractsData);\r\n        setFilteredContracts(contractsData);\r\n        setPagination(paginationData);\r\n      } else {\r\n        showError(response.message || 'Không thể tải danh sách hợp đồng');\r\n      }\r\n    } catch (error) {\r\n      console.warn('Contract loading error:', error?.message || error);\r\n      // showError('Lỗi kết nối: ' + error.message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [filters, pagination.limit, showError]);\r\n\r\n  useEffect(() => {\r\n    if (hasPermission('contract_read')) {\r\n      loadContracts();\r\n    }\r\n  }, [hasPermission, loadContracts, pagination.page]);\r\n\r\n  // Handle filter changes\r\n  useEffect(() => {\r\n    // Debounce search to avoid too many API calls\r\n    const timeoutId = setTimeout(() => {\r\n      if (pagination.page === 1) {\r\n        loadContracts(1);\r\n      } else {\r\n        setPagination(prev => ({ ...prev, page: 1 }));\r\n        loadContracts(1);\r\n      }\r\n    }, 500);\r\n\r\n    return () => clearTimeout(timeoutId);\r\n  }, [filters]);\r\n\r\n  // Format currency\r\n  const formatCurrency = (amount) => {\r\n    return new Intl.NumberFormat('vi-VN', {\r\n      style: 'currency',\r\n      currency: 'VND'\r\n    }).format(amount);\r\n  };\r\n\r\n  // Calculate contract value\r\n  // const calculateContractValue = (contract) => {\r\n  //   const startDate = new Date(contract.start_date);\r\n  //   const endDate = new Date(contract.end_date);\r\n  //   const months = (endDate.getFullYear() - startDate.getFullYear()) * 12 + \r\n  //                  (endDate.getMonth() - startDate.getMonth());\r\n  //   return contract.rental_price * months;\r\n  // };\r\n\r\n  // Handle contract status change\r\n  const handleStatusChange = async (contractId, newStatus, newStage) => {\r\n    try {\r\n      const statusData = { \r\n        status: newStatus, \r\n        workflow_stage: newStage,\r\n        comment: `Chuyển trạng thái sang ${contractStatuses[newStatus]?.label}` \r\n      };\r\n\r\n      const response = await contractService.updateContractStatus(contractId, statusData);\r\n      \r\n      if (response.success) {\r\n        showSuccess('Cập nhật trạng thái thành công');\r\n        loadContracts(pagination.page);\r\n      } else {\r\n        showError(response.message || 'Không thể cập nhật trạng thái');\r\n      }\r\n    } catch (error) {\r\n      showError('Lỗi kết nối: ' + error.message);\r\n    }\r\n  };\r\n\r\n  // View contract details\r\n  const viewContractDetails = async (contractId) => {\r\n    try {\r\n      const response = await contractService.getContract(contractId);\r\n      \r\n      if (response.success) {\r\n        setSelectedContract(response.data);\r\n        setShowDetailModal(true);\r\n      } else {\r\n        showError(response.message || 'Không thể tải chi tiết hợp đồng');\r\n      }\r\n    } catch (error) {\r\n      showError('Lỗi kết nối: ' + error.message);\r\n    }\r\n  };\r\n\r\n  if (!hasPermission('contract_read')) {\r\n    return (\r\n      <Container className=\"mt-4\">\r\n        <div className=\"alert alert-warning\">\r\n          Bạn không có quyền truy cập quản lý hợp đồng.\r\n        </div>\r\n      </Container>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"mt-4\">\r\n      <Row>\r\n        <Col>\r\n          {/* Header */}\r\n          <div className=\"d-flex justify-content-between align-items-center mb-4\">\r\n            <h2>\r\n              <i className=\"fas fa-file-contract me-2\"></i>\r\n              Quản lý hợp đồng\r\n            </h2>\r\n            \r\n            {hasPermission('contract_create') && (\r\n              <Button \r\n                variant=\"primary\" \r\n                onClick={() => {\r\n                  try {\r\n                    const params = new URLSearchParams(window.location.search);\r\n                    params.set('open', 'create');\r\n                    if (selectedRowCustomerId) params.set('customer', selectedRowCustomerId);\r\n                    const newUrl = `${window.location.pathname}?${params.toString()}`;\r\n                    window.history.replaceState({}, '', newUrl);\r\n                  } catch (e) {}\r\n                  setShowCreateModal(true);\r\n                }}\r\n              >\r\n                <i className=\"fas fa-plus me-2\"></i>\r\n                Tạo hợp đồng mới\r\n              </Button>\r\n            )}\r\n          </div>\r\n\r\n          {/* Filters */}\r\n          <Card className=\"mb-4\">\r\n            <Card.Header>\r\n              <h5 className=\"mb-0\">\r\n                <i className=\"fas fa-filter me-2\"></i>\r\n                Bộ lọc\r\n              </h5>\r\n            </Card.Header>\r\n            <Card.Body>\r\n              <Row>\r\n                <Col md={3}>\r\n                  <Form.Group className=\"mb-3\">\r\n                    <Form.Label>Tìm kiếm</Form.Label>\r\n                    <Form.Control\r\n                      type=\"text\"\r\n                      placeholder=\"Số HĐ, tên khách hàng...\"\r\n                      value={filters.search}\r\n                      onChange={(e) => setFilters(prev => ({ \r\n                        ...prev, \r\n                        search: e.target.value \r\n                      }))}\r\n                    />\r\n                  </Form.Group>\r\n                </Col>\r\n                \r\n                <Col md={2}>\r\n                  <Form.Group className=\"mb-3\">\r\n                    <Form.Label>Trạng thái</Form.Label>\r\n                    <Form.Select\r\n                      value={filters.status}\r\n                      onChange={(e) => setFilters(prev => ({ \r\n                        ...prev, \r\n                        status: e.target.value \r\n                      }))}\r\n                    >\r\n                      <option value=\"\">Tất cả</option>\r\n                      {Object.entries(contractStatuses).map(([key, status]) => (\r\n                        <option key={key} value={key}>{status.label}</option>\r\n                      ))}\r\n                    </Form.Select>\r\n                  </Form.Group>\r\n                </Col>\r\n                \r\n                <Col md={2}>\r\n                  <Form.Group className=\"mb-3\">\r\n                    <Form.Label>Giai đoạn</Form.Label>\r\n                    <Form.Select\r\n                      value={filters.workflow_stage}\r\n                      onChange={(e) => setFilters(prev => ({ \r\n                        ...prev, \r\n                        workflow_stage: e.target.value \r\n                      }))}\r\n                    >\r\n                      <option value=\"\">Tất cả</option>\r\n                      {Object.entries(workflowStages).map(([key, stage]) => (\r\n                        <option key={key} value={key}>{stage.label}</option>\r\n                      ))}\r\n                    </Form.Select>\r\n                  </Form.Group>\r\n                </Col>\r\n                \r\n                <Col md={2}>\r\n                  <Form.Group className=\"mb-3\">\r\n                    <Form.Label>Từ ngày</Form.Label>\r\n                    <Form.Control\r\n                      type=\"date\"\r\n                      value={filters.start_date_from}\r\n                      onChange={(e) => setFilters(prev => ({ \r\n                        ...prev, \r\n                        start_date_from: e.target.value \r\n                      }))}\r\n                    />\r\n                  </Form.Group>\r\n                </Col>\r\n                \r\n                <Col md={2}>\r\n                  <Form.Group className=\"mb-3\">\r\n                    <Form.Label>Đến ngày</Form.Label>\r\n                    <Form.Control\r\n                      type=\"date\"\r\n                      value={filters.start_date_to}\r\n                      onChange={(e) => setFilters(prev => ({ \r\n                        ...prev, \r\n                        start_date_to: e.target.value \r\n                      }))}\r\n                    />\r\n                  </Form.Group>\r\n                </Col>\r\n                \r\n                <Col md={1} className=\"d-flex align-items-end\">\r\n                  <Button \r\n                    variant=\"outline-secondary\" \r\n                    onClick={() => setFilters({\r\n                      search: '',\r\n                      status: '',\r\n                      workflow_stage: '',\r\n                      start_date_from: '',\r\n                      start_date_to: ''\r\n                    })}\r\n                  >\r\n                    <i className=\"fas fa-undo\"></i>\r\n                  </Button>\r\n                </Col>\r\n              </Row>\r\n            </Card.Body>\r\n          </Card>\r\n\r\n          {/* Contracts Table */}\r\n          <Card>\r\n            <Card.Header className=\"d-flex justify-content-between align-items-center\">\r\n              <h5 className=\"mb-0\">\r\n                Danh sách hợp đồng ({pagination.total})\r\n              </h5>\r\n              \r\n              <div className=\"d-flex gap-2\">\r\n                <Button variant=\"outline-primary\" size=\"sm\">\r\n                  <i className=\"fas fa-download me-2\"></i>\r\n                  Xuất Excel\r\n                </Button>\r\n                <Button variant=\"outline-secondary\" size=\"sm\" onClick={() => loadContracts(pagination.page)}>\r\n                  <i className=\"fas fa-sync-alt\"></i>\r\n                </Button>\r\n              </div>\r\n            </Card.Header>\r\n            \r\n            <Card.Body className=\"p-0\">\r\n              {loading ? (\r\n                <div className=\"text-center p-4\">\r\n                  <LoadingSpinner />\r\n                </div>\r\n              ) : (\r\n                renderError ? (\r\n                  <div className=\"p-4\">\r\n                    <div className=\"alert alert-danger\">\r\n                      <strong>Lỗi hiển thị danh sách hợp đồng:</strong>\r\n                      <div>{String(renderError)}</div>\r\n                    </div>\r\n                    <div className=\"text-muted\">Vui lòng tải lại trang hoặc liên hệ admin.</div>\r\n                  </div>\r\n                ) : (\r\n                <Table responsive hover className=\"mb-0\">\r\n                  <thead className=\"table-light\">\r\n                    <tr>\r\n                      <th>Số hợp đồng</th>\r\n                      <th>Khách hàng</th>\r\n                      <th>Dự án</th>\r\n                      <th>Diện tích</th>\r\n                      <th>Giá thuê/tháng</th>\r\n                      <th>Thời hạn</th>\r\n                      <th>Trạng thái</th>\r\n                      <th>Giai đoạn</th>\r\n                      <th>Người phụ trách</th>\r\n                      <th>Thao tác</th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody>\r\n                    {(() => {\r\n                      try {\r\n                        return (filteredContracts || []).map(contract => (\r\n                          <tr key={contract.id}\r\n                              className={String(selectedRowCustomerId) === String(contract.customer_id) ? 'table-active' : ''}\r\n                              onClick={() => setSelectedRowCustomerId(contract.customer_id)}\r\n                          >\r\n                            <td>\r\n                              <strong>{contract.contract_number}</strong>\r\n                              <br/>\r\n                              <small className=\"text-muted\">\r\n                                {contract.created_at ? new Date(contract.created_at).toLocaleDateString('vi-VN') : ''}\r\n                              </small>\r\n                            </td>\r\n                            <td>\r\n                              <div>\r\n                                <strong>{contract.customer_company_name || contract.company_name}</strong>\r\n                                <br/>\r\n                                <small className=\"text-muted\">{contract.customer_name}</small>\r\n                              </div>\r\n                            </td>\r\n                            <td>\r\n                              <div>\r\n                                <strong>{contract.project_name || 'Chưa phân bổ'}</strong>\r\n                                <br/>\r\n                                <small className=\"text-muted\">{contract.warehouse_location}</small>\r\n                              </div>\r\n                            </td>\r\n                            <td>\r\n                              {contract.warehouse_area ?? 'N/A'} m²\r\n                            </td>\r\n                            <td>\r\n                              {formatCurrency(contract.rental_price ?? 0)}\r\n                              <br/>\r\n                              <small className=\"text-muted\">\r\n                                {contract.warehouse_area ? formatCurrency((contract.rental_price ?? 0) / contract.warehouse_area) + '/m²' : 'N/A'}\r\n                              </small>\r\n                            </td>\r\n                            <td>\r\n                              {contract.start_date ? new Date(contract.start_date).toLocaleDateString('vi-VN') : ''}\r\n                              <br/>\r\n                              <small className=\"text-muted\">\r\n                                → {contract.end_date ? new Date(contract.end_date).toLocaleDateString('vi-VN') : ''}\r\n                              </small>\r\n                            </td>\r\n                            <td>\r\n                              <Badge bg={contractStatuses[contract.status]?.variant || 'secondary'}>\r\n                                {contractStatuses[contract.status]?.label || contract.status}\r\n                              </Badge>\r\n                            </td>\r\n                            <td>\r\n                              <div className=\"d-flex align-items-center\">\r\n                                <i className={`${workflowStages[contract.workflow_stage]?.icon} me-2`}></i>\r\n                                <small>{workflowStages[contract.workflow_stage]?.label}</small>\r\n                              </div>\r\n                            </td>\r\n                            <td>\r\n                              {contract.assigned_to_name ? (\r\n                                <Badge bg=\"info\">{contract.assigned_to_name}</Badge>\r\n                              ) : (\r\n                                <span className=\"text-muted\">Chưa giao</span>\r\n                              )}\r\n                            </td>\r\n                            <td>\r\n                              <div className=\"d-flex gap-1\">\r\n                                <OverlayTrigger \r\n                                  overlay={<Tooltip>Xem chi tiết</Tooltip>}\r\n                                >\r\n                                  <Button \r\n                                    variant=\"outline-primary\" \r\n                                    size=\"sm\"\r\n                                    onClick={() => viewContractDetails(contract.id)}\r\n                                  >\r\n                                    <i className=\"fas fa-eye\"></i>\r\n                                  </Button>\r\n                                </OverlayTrigger>\r\n                                \r\n                                {hasPermission('contract_update') && (\r\n                                  <Dropdown>\r\n                                    <Dropdown.Toggle \r\n                                      variant=\"outline-secondary\" \r\n                                      size=\"sm\"\r\n                                      id={`dropdown-${contract.id}`}\r\n                                    >\r\n                                      <i className=\"fas fa-cog\"></i>\r\n                                    </Dropdown.Toggle>\r\n                                    <Dropdown.Menu>\r\n                                      <Dropdown.Item \r\n                                        onClick={() => handleStatusChange(contract.id, 'review', 'legal_review')}\r\n                                      >\r\n                                        <i className=\"fas fa-eye me-2\"></i>\r\n                                        Gửi xem xét\r\n                                      </Dropdown.Item>\r\n                                      <Dropdown.Item \r\n                                        onClick={() => handleStatusChange(contract.id, 'approved', 'signing')}\r\n                                      >\r\n                                        <i className=\"fas fa-check me-2\"></i>\r\n                                        Phê duyệt\r\n                                      </Dropdown.Item>\r\n                                      <Dropdown.Item \r\n                                        onClick={() => handleStatusChange(contract.id, 'signed', 'execution')}\r\n                                      >\r\n                                        <i className=\"fas fa-signature me-2\"></i>\r\n                                        Đã ký\r\n                                      </Dropdown.Item>\r\n                                      <Dropdown.Divider />\r\n                                      <Dropdown.Item className=\"text-danger\">\r\n                                        <i className=\"fas fa-trash me-2\"></i>\r\n                                        Hủy bỏ\r\n                                      </Dropdown.Item>\r\n                                    </Dropdown.Menu>\r\n                                  </Dropdown>\r\n                                )}\r\n                              </div>\r\n                            </td>\r\n                          </tr>\r\n                        ));\r\n                      } catch (err) {\r\n                        console.error('Render error in ContractManager:', err);\r\n                        setRenderError(err?.message || String(err));\r\n                        return null;\r\n                      }\r\n                    })()}\r\n                  </tbody>\r\n                </Table>\r\n               )\r\n             )}\r\n            </Card.Body>\r\n            \r\n            {/* Pagination */}\r\n            {pagination.pages > 1 && (\r\n              <Card.Footer>\r\n                <div className=\"d-flex justify-content-between align-items-center\">\r\n                  <small className=\"text-muted\">\r\n                    Hiển thị {((pagination.page - 1) * pagination.limit) + 1} - {Math.min(pagination.page * pagination.limit, pagination.total)} \r\n                    trong tổng số {pagination.total} hợp đồng\r\n                  </small>\r\n                  \r\n                  <div className=\"d-flex gap-2\">\r\n                    <Button \r\n                      variant=\"outline-secondary\" \r\n                      size=\"sm\"\r\n                      disabled={pagination.page === 1}\r\n                      onClick={() => setPagination(prev => ({ ...prev, page: prev.page - 1 }))}\r\n                    >\r\n                      <i className=\"fas fa-chevron-left\"></i>\r\n                    </Button>\r\n                    \r\n                    <span className=\"d-flex align-items-center px-3\">\r\n                      Trang {pagination.page} / {pagination.pages}\r\n                    </span>\r\n                    \r\n                    <Button \r\n                      variant=\"outline-secondary\" \r\n                      size=\"sm\"\r\n                      disabled={pagination.page === pagination.pages}\r\n                      onClick={() => setPagination(prev => ({ ...prev, page: prev.page + 1 }))}\r\n                    >\r\n                      <i className=\"fas fa-chevron-right\"></i>\r\n                    </Button>\r\n                  </div>\r\n                </div>\r\n              </Card.Footer>\r\n            )}\r\n          </Card>\r\n        </Col>\r\n      </Row>\r\n\r\n      {/* Create Contract Modal */}\r\n      <ContractCreator\r\n        show={showCreateModal}\r\n        initialCustomerId={selectedRowCustomerId || initialCustomerId}\r\n        onHide={() => setShowCreateModal(false)}\r\n        onSuccess={() => {\r\n          setShowCreateModal(false);\r\n          loadContracts(pagination.page);\r\n        }}\r\n      />\r\n\r\n      {/* Contract Detail Modal */}\r\n      {selectedContract && (\r\n        <Modal \r\n          show={showDetailModal} \r\n          onHide={() => setShowDetailModal(false)} \r\n          size=\"xl\"\r\n          scrollable\r\n        >\r\n          <Modal.Header closeButton>\r\n            <Modal.Title>\r\n              Chi tiết hợp đồng {selectedContract.contract.contract_number}\r\n            </Modal.Title>\r\n          </Modal.Header>\r\n          <Modal.Body>\r\n            <ContractDetailView contract={selectedContract} />\r\n          </Modal.Body>\r\n        </Modal>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\n// Contract Detail Component  \r\nconst ContractDetailView = ({ contract }) => {\r\n  return (\r\n    <Tabs defaultActiveKey=\"overview\" id=\"contract-detail-tabs\">\r\n      <Tab eventKey=\"overview\" title=\"Tổng quan\">\r\n        <div className=\"pt-3\">\r\n          <Row>\r\n            <Col md={6}>\r\n              <h5>Thông tin hợp đồng</h5>\r\n              <Table size=\"sm\">\r\n                <tbody>\r\n                  <tr>\r\n                    <td><strong>Số hợp đồng:</strong></td>\r\n                    <td>{contract.contract.contract_number}</td>\r\n                  </tr>\r\n                  <tr>\r\n                    <td><strong>Tiêu đề:</strong></td>\r\n                    <td>{contract.contract.contract_title}</td>\r\n                  </tr>\r\n                  <tr>\r\n                    <td><strong>Dự án:</strong></td>\r\n                    <td>{contract.contract.project_name || 'Chưa phân bổ'}</td>\r\n                  </tr>\r\n                  <tr>\r\n                    <td><strong>Kho:</strong></td>\r\n                    <td>{contract.contract.warehouse_location}</td>\r\n                  </tr>\r\n                  <tr>\r\n                    <td><strong>Diện tích:</strong></td>\r\n                    <td>{contract.contract.warehouse_area} m²</td>\r\n                  </tr>\r\n                  <tr>\r\n                    <td><strong>Giá thuê:</strong></td>\r\n                    <td>{new Intl.NumberFormat('vi-VN').format(contract.contract.rental_price)} VNĐ/tháng</td>\r\n                  </tr>\r\n                </tbody>\r\n              </Table>\r\n            </Col>\r\n            <Col md={6}>\r\n              <h5>Thông tin khách hàng</h5>\r\n              <Table size=\"sm\">\r\n                <tbody>\r\n                  <tr>\r\n                    <td><strong>Công ty:</strong></td>\r\n                    <td>{contract.contract.customer_company_name}</td>\r\n                  </tr>\r\n                  <tr>\r\n                    <td><strong>Người liên hệ:</strong></td>\r\n                    <td>{contract.contract.customer_name}</td>\r\n                  </tr>\r\n                  <tr>\r\n                    <td><strong>Điện thoại:</strong></td>\r\n                    <td>{contract.contract.customer_phone}</td>\r\n                  </tr>\r\n                  <tr>\r\n                    <td><strong>Email:</strong></td>\r\n                    <td>{contract.contract.customer_email}</td>\r\n                  </tr>\r\n                  <tr>\r\n                    <td><strong>Mã số thuế:</strong></td>\r\n                    <td>{contract.contract.tax_code}</td>\r\n                  </tr>\r\n                </tbody>\r\n              </Table>\r\n            </Col>\r\n          </Row>\r\n        </div>\r\n      </Tab>\r\n      \r\n      <Tab eventKey=\"documents\" title={`Tài liệu (${contract.documents?.length || 0})`}>\r\n        <div className=\"pt-3\">\r\n          {contract.documents?.length > 0 ? (\r\n            <Table>\r\n              <thead>\r\n                <tr>\r\n                  <th>Tên tài liệu</th>\r\n                  <th>Loại</th>\r\n                  <th>Phiên bản</th>\r\n                  <th>Trạng thái</th>\r\n                  <th>Ngày tạo</th>\r\n                  <th>Thao tác</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {contract.documents.map(doc => (\r\n                  <tr key={doc.id}>\r\n                    <td>{doc.document_name}</td>\r\n                    <td>\r\n                      <Badge bg=\"info\">{doc.category_name}</Badge>\r\n                    </td>\r\n                    <td>v{doc.version}</td>\r\n                    <td>\r\n                      <Badge \r\n                        bg={doc.status === 'final' ? 'success' : \r\n                            doc.status === 'draft' ? 'secondary' : 'warning'}\r\n                      >\r\n                        {doc.status}\r\n                      </Badge>\r\n                    </td>\r\n                    <td>{new Date(doc.created_at).toLocaleDateString('vi-VN')}</td>\r\n                    <td>\r\n                      <Button variant=\"outline-primary\" size=\"sm\">\r\n                        <i className=\"fas fa-eye\"></i>\r\n                      </Button>\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </Table>\r\n          ) : (\r\n            <div className=\"text-center text-muted py-4\">\r\n              Chưa có tài liệu nào\r\n            </div>\r\n          )}\r\n        </div>\r\n      </Tab>\r\n      \r\n      <Tab eventKey=\"history\" title=\"Lịch sử\">\r\n        <div className=\"pt-3\">\r\n          {contract.workflow_history?.length > 0 ? (\r\n            <div className=\"timeline\">\r\n              {contract.workflow_history.map(history => (\r\n                <div key={history.id} className=\"timeline-item mb-3\">\r\n                  <div className=\"d-flex\">\r\n                    <div className=\"flex-shrink-0\">\r\n                      <div className=\"rounded-circle bg-primary text-white d-flex align-items-center justify-content-center\" style={{width: '40px', height: '40px'}}>\r\n                        <i className=\"fas fa-user fa-sm\"></i>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"flex-grow-1 ms-3\">\r\n                      <div className=\"d-flex justify-content-between\">\r\n                        <h6 className=\"mb-1\">{history.action}</h6>\r\n                        <small className=\"text-muted\">{new Date(history.performed_at).toLocaleString('vi-VN')}</small>\r\n                      </div>\r\n                      <p className=\"mb-1\">{history.comment}</p>\r\n                      <small className=\"text-muted\">Bởi: {history.performed_by_name}</small>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          ) : (\r\n            <div className=\"text-center text-muted py-4\">\r\n              Chưa có lịch sử nào\r\n            </div>\r\n          )}\r\n        </div>\r\n      </Tab>\r\n    </Tabs>\r\n  );\r\n};\r\n\r\nexport default ContractManager;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}