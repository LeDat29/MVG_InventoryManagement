{"ast":null,"code":"import _objectSpread from\"D:/MinhVietGroup/InventoryProject/MVG_InventoryManagement/KinhDoanh/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";/**\r\n * Cache Optimizer - KHO MVG\r\n * Quản lý cache để tối ưu hiệu suất\r\n */class CacheOptimizer{constructor(){this.cache=new Map();this.maxSize=100;this.defaultTTL=5*60*1000;// 5 minutes\nthis.stats={hits:0,misses:0,sets:0,deletes:0};}// Cache contract templates\ncacheContractTemplates(templates){this.set('contract_templates',templates,10*60*1000);// 10 minutes\n}getContractTemplates(){return this.get('contract_templates');}// Cache customer data\ncacheCustomer(customerId,customerData){this.set(\"customer_\".concat(customerId),customerData,5*60*1000);}getCustomer(customerId){return this.get(\"customer_\".concat(customerId));}// Cache contract data\ncacheContract(contractId,contractData){this.set(\"contract_\".concat(contractId),contractData,3*60*1000);}getContract(contractId){return this.get(\"contract_\".concat(contractId));}// Generic cache methods\nset(key,value){let ttl=arguments.length>2&&arguments[2]!==undefined?arguments[2]:this.defaultTTL;// Remove oldest item if cache is full\nif(this.cache.size>=this.maxSize){const oldestKey=this.cache.keys().next().value;this.cache.delete(oldestKey);this.stats.deletes++;}this.cache.set(key,{value,timestamp:Date.now(),ttl});this.stats.sets++;}get(key){const item=this.cache.get(key);if(!item){this.stats.misses++;return null;}// Check if item has expired\nif(Date.now()-item.timestamp>item.ttl){this.cache.delete(key);this.stats.deletes++;this.stats.misses++;return null;}this.stats.hits++;return item.value;}delete(key){const deleted=this.cache.delete(key);if(deleted)this.stats.deletes++;return deleted;}clear(){this.cache.clear();this.stats={hits:0,misses:0,sets:0,deletes:0};}// Cache statistics\ngetStats(){const total=this.stats.hits+this.stats.misses;const hitRate=total>0?this.stats.hits/total*100:0;return _objectSpread(_objectSpread({},this.stats),{},{total,hitRate:hitRate.toFixed(2),size:this.cache.size,maxSize:this.maxSize});}// Invalidate related cache entries\ninvalidatePattern(pattern){const keysToDelete=[];for(const key of this.cache.keys()){if(key.includes(pattern)){keysToDelete.push(key);}}keysToDelete.forEach(key=>this.delete(key));return keysToDelete.length;}// Preload important data\nasync preloadEssentialData(){try{const token=localStorage.getItem('token');if(!token)return;const headers={'Authorization':\"Bearer \".concat(token)};// Preload contract templates\nconst templatesResponse=await fetch('/api/contract-templates',{headers});if(templatesResponse.ok){const templates=await templatesResponse.json();this.cacheContractTemplates(templates.data);}// Preload user permissions if available\nconst userResponse=await fetch('/api/users/profile',{headers});if(userResponse.ok){const user=await userResponse.json();this.set('user_profile',user.data,15*60*1000);// 15 minutes\n}}catch(error){console.warn('Cache preload failed:',error);}}}// Create singleton instance\nconst cacheOptimizer=new CacheOptimizer();// Expose to window for debugging\nif(process.env.NODE_ENV==='development'){window.cacheOptimizer=cacheOptimizer;}export default cacheOptimizer;","map":{"version":3,"names":["CacheOptimizer","constructor","cache","Map","maxSize","defaultTTL","stats","hits","misses","sets","deletes","cacheContractTemplates","templates","set","getContractTemplates","get","cacheCustomer","customerId","customerData","concat","getCustomer","cacheContract","contractId","contractData","getContract","key","value","ttl","arguments","length","undefined","size","oldestKey","keys","next","delete","timestamp","Date","now","item","deleted","clear","getStats","total","hitRate","_objectSpread","toFixed","invalidatePattern","pattern","keysToDelete","includes","push","forEach","preloadEssentialData","token","localStorage","getItem","headers","templatesResponse","fetch","ok","json","data","userResponse","user","error","console","warn","cacheOptimizer","process","env","NODE_ENV","window"],"sources":["D:/MinhVietGroup/InventoryProject/MVG_InventoryManagement/KinhDoanh/client/src/utils/cacheOptimizer.js"],"sourcesContent":["/**\r\n * Cache Optimizer - KHO MVG\r\n * Quản lý cache để tối ưu hiệu suất\r\n */\r\n\r\nclass CacheOptimizer {\r\n  constructor() {\r\n    this.cache = new Map();\r\n    this.maxSize = 100;\r\n    this.defaultTTL = 5 * 60 * 1000; // 5 minutes\r\n    this.stats = {\r\n      hits: 0,\r\n      misses: 0,\r\n      sets: 0,\r\n      deletes: 0\r\n    };\r\n  }\r\n\r\n  // Cache contract templates\r\n  cacheContractTemplates(templates) {\r\n    this.set('contract_templates', templates, 10 * 60 * 1000); // 10 minutes\r\n  }\r\n\r\n  getContractTemplates() {\r\n    return this.get('contract_templates');\r\n  }\r\n\r\n  // Cache customer data\r\n  cacheCustomer(customerId, customerData) {\r\n    this.set(`customer_${customerId}`, customerData, 5 * 60 * 1000);\r\n  }\r\n\r\n  getCustomer(customerId) {\r\n    return this.get(`customer_${customerId}`);\r\n  }\r\n\r\n  // Cache contract data\r\n  cacheContract(contractId, contractData) {\r\n    this.set(`contract_${contractId}`, contractData, 3 * 60 * 1000);\r\n  }\r\n\r\n  getContract(contractId) {\r\n    return this.get(`contract_${contractId}`);\r\n  }\r\n\r\n  // Generic cache methods\r\n  set(key, value, ttl = this.defaultTTL) {\r\n    // Remove oldest item if cache is full\r\n    if (this.cache.size >= this.maxSize) {\r\n      const oldestKey = this.cache.keys().next().value;\r\n      this.cache.delete(oldestKey);\r\n      this.stats.deletes++;\r\n    }\r\n\r\n    this.cache.set(key, {\r\n      value,\r\n      timestamp: Date.now(),\r\n      ttl\r\n    });\r\n    this.stats.sets++;\r\n  }\r\n\r\n  get(key) {\r\n    const item = this.cache.get(key);\r\n    \r\n    if (!item) {\r\n      this.stats.misses++;\r\n      return null;\r\n    }\r\n\r\n    // Check if item has expired\r\n    if (Date.now() - item.timestamp > item.ttl) {\r\n      this.cache.delete(key);\r\n      this.stats.deletes++;\r\n      this.stats.misses++;\r\n      return null;\r\n    }\r\n\r\n    this.stats.hits++;\r\n    return item.value;\r\n  }\r\n\r\n  delete(key) {\r\n    const deleted = this.cache.delete(key);\r\n    if (deleted) this.stats.deletes++;\r\n    return deleted;\r\n  }\r\n\r\n  clear() {\r\n    this.cache.clear();\r\n    this.stats = {\r\n      hits: 0,\r\n      misses: 0,\r\n      sets: 0,\r\n      deletes: 0\r\n    };\r\n  }\r\n\r\n  // Cache statistics\r\n  getStats() {\r\n    const total = this.stats.hits + this.stats.misses;\r\n    const hitRate = total > 0 ? (this.stats.hits / total) * 100 : 0;\r\n    \r\n    return {\r\n      ...this.stats,\r\n      total,\r\n      hitRate: hitRate.toFixed(2),\r\n      size: this.cache.size,\r\n      maxSize: this.maxSize\r\n    };\r\n  }\r\n\r\n  // Invalidate related cache entries\r\n  invalidatePattern(pattern) {\r\n    const keysToDelete = [];\r\n    for (const key of this.cache.keys()) {\r\n      if (key.includes(pattern)) {\r\n        keysToDelete.push(key);\r\n      }\r\n    }\r\n    \r\n    keysToDelete.forEach(key => this.delete(key));\r\n    return keysToDelete.length;\r\n  }\r\n\r\n  // Preload important data\r\n  async preloadEssentialData() {\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      if (!token) return;\r\n\r\n      const headers = { 'Authorization': `Bearer ${token}` };\r\n      \r\n      // Preload contract templates\r\n      const templatesResponse = await fetch('/api/contract-templates', { headers });\r\n      if (templatesResponse.ok) {\r\n        const templates = await templatesResponse.json();\r\n        this.cacheContractTemplates(templates.data);\r\n      }\r\n\r\n      // Preload user permissions if available\r\n      const userResponse = await fetch('/api/users/profile', { headers });\r\n      if (userResponse.ok) {\r\n        const user = await userResponse.json();\r\n        this.set('user_profile', user.data, 15 * 60 * 1000); // 15 minutes\r\n      }\r\n\r\n    } catch (error) {\r\n      console.warn('Cache preload failed:', error);\r\n    }\r\n  }\r\n}\r\n\r\n// Create singleton instance\r\nconst cacheOptimizer = new CacheOptimizer();\r\n\r\n// Expose to window for debugging\r\nif (process.env.NODE_ENV === 'development') {\r\n  window.cacheOptimizer = cacheOptimizer;\r\n}\r\n\r\nexport default cacheOptimizer;"],"mappings":"+JAAA;AACA;AACA;AACA,GAEA,KAAM,CAAAA,cAAe,CACnBC,WAAWA,CAAA,CAAG,CACZ,IAAI,CAACC,KAAK,CAAG,GAAI,CAAAC,GAAG,CAAC,CAAC,CACtB,IAAI,CAACC,OAAO,CAAG,GAAG,CAClB,IAAI,CAACC,UAAU,CAAG,CAAC,CAAG,EAAE,CAAG,IAAI,CAAE;AACjC,IAAI,CAACC,KAAK,CAAG,CACXC,IAAI,CAAE,CAAC,CACPC,MAAM,CAAE,CAAC,CACTC,IAAI,CAAE,CAAC,CACPC,OAAO,CAAE,CACX,CAAC,CACH,CAEA;AACAC,sBAAsBA,CAACC,SAAS,CAAE,CAChC,IAAI,CAACC,GAAG,CAAC,oBAAoB,CAAED,SAAS,CAAE,EAAE,CAAG,EAAE,CAAG,IAAI,CAAC,CAAE;AAC7D,CAEAE,oBAAoBA,CAAA,CAAG,CACrB,MAAO,KAAI,CAACC,GAAG,CAAC,oBAAoB,CAAC,CACvC,CAEA;AACAC,aAAaA,CAACC,UAAU,CAAEC,YAAY,CAAE,CACtC,IAAI,CAACL,GAAG,aAAAM,MAAA,CAAaF,UAAU,EAAIC,YAAY,CAAE,CAAC,CAAG,EAAE,CAAG,IAAI,CAAC,CACjE,CAEAE,WAAWA,CAACH,UAAU,CAAE,CACtB,MAAO,KAAI,CAACF,GAAG,aAAAI,MAAA,CAAaF,UAAU,CAAE,CAAC,CAC3C,CAEA;AACAI,aAAaA,CAACC,UAAU,CAAEC,YAAY,CAAE,CACtC,IAAI,CAACV,GAAG,aAAAM,MAAA,CAAaG,UAAU,EAAIC,YAAY,CAAE,CAAC,CAAG,EAAE,CAAG,IAAI,CAAC,CACjE,CAEAC,WAAWA,CAACF,UAAU,CAAE,CACtB,MAAO,KAAI,CAACP,GAAG,aAAAI,MAAA,CAAaG,UAAU,CAAE,CAAC,CAC3C,CAEA;AACAT,GAAGA,CAACY,GAAG,CAAEC,KAAK,CAAyB,IAAvB,CAAAC,GAAG,CAAAC,SAAA,CAAAC,MAAA,IAAAD,SAAA,MAAAE,SAAA,CAAAF,SAAA,IAAG,IAAI,CAACvB,UAAU,CACnC;AACA,GAAI,IAAI,CAACH,KAAK,CAAC6B,IAAI,EAAI,IAAI,CAAC3B,OAAO,CAAE,CACnC,KAAM,CAAA4B,SAAS,CAAG,IAAI,CAAC9B,KAAK,CAAC+B,IAAI,CAAC,CAAC,CAACC,IAAI,CAAC,CAAC,CAACR,KAAK,CAChD,IAAI,CAACxB,KAAK,CAACiC,MAAM,CAACH,SAAS,CAAC,CAC5B,IAAI,CAAC1B,KAAK,CAACI,OAAO,EAAE,CACtB,CAEA,IAAI,CAACR,KAAK,CAACW,GAAG,CAACY,GAAG,CAAE,CAClBC,KAAK,CACLU,SAAS,CAAEC,IAAI,CAACC,GAAG,CAAC,CAAC,CACrBX,GACF,CAAC,CAAC,CACF,IAAI,CAACrB,KAAK,CAACG,IAAI,EAAE,CACnB,CAEAM,GAAGA,CAACU,GAAG,CAAE,CACP,KAAM,CAAAc,IAAI,CAAG,IAAI,CAACrC,KAAK,CAACa,GAAG,CAACU,GAAG,CAAC,CAEhC,GAAI,CAACc,IAAI,CAAE,CACT,IAAI,CAACjC,KAAK,CAACE,MAAM,EAAE,CACnB,MAAO,KAAI,CACb,CAEA;AACA,GAAI6B,IAAI,CAACC,GAAG,CAAC,CAAC,CAAGC,IAAI,CAACH,SAAS,CAAGG,IAAI,CAACZ,GAAG,CAAE,CAC1C,IAAI,CAACzB,KAAK,CAACiC,MAAM,CAACV,GAAG,CAAC,CACtB,IAAI,CAACnB,KAAK,CAACI,OAAO,EAAE,CACpB,IAAI,CAACJ,KAAK,CAACE,MAAM,EAAE,CACnB,MAAO,KAAI,CACb,CAEA,IAAI,CAACF,KAAK,CAACC,IAAI,EAAE,CACjB,MAAO,CAAAgC,IAAI,CAACb,KAAK,CACnB,CAEAS,MAAMA,CAACV,GAAG,CAAE,CACV,KAAM,CAAAe,OAAO,CAAG,IAAI,CAACtC,KAAK,CAACiC,MAAM,CAACV,GAAG,CAAC,CACtC,GAAIe,OAAO,CAAE,IAAI,CAAClC,KAAK,CAACI,OAAO,EAAE,CACjC,MAAO,CAAA8B,OAAO,CAChB,CAEAC,KAAKA,CAAA,CAAG,CACN,IAAI,CAACvC,KAAK,CAACuC,KAAK,CAAC,CAAC,CAClB,IAAI,CAACnC,KAAK,CAAG,CACXC,IAAI,CAAE,CAAC,CACPC,MAAM,CAAE,CAAC,CACTC,IAAI,CAAE,CAAC,CACPC,OAAO,CAAE,CACX,CAAC,CACH,CAEA;AACAgC,QAAQA,CAAA,CAAG,CACT,KAAM,CAAAC,KAAK,CAAG,IAAI,CAACrC,KAAK,CAACC,IAAI,CAAG,IAAI,CAACD,KAAK,CAACE,MAAM,CACjD,KAAM,CAAAoC,OAAO,CAAGD,KAAK,CAAG,CAAC,CAAI,IAAI,CAACrC,KAAK,CAACC,IAAI,CAAGoC,KAAK,CAAI,GAAG,CAAG,CAAC,CAE/D,OAAAE,aAAA,CAAAA,aAAA,IACK,IAAI,CAACvC,KAAK,MACbqC,KAAK,CACLC,OAAO,CAAEA,OAAO,CAACE,OAAO,CAAC,CAAC,CAAC,CAC3Bf,IAAI,CAAE,IAAI,CAAC7B,KAAK,CAAC6B,IAAI,CACrB3B,OAAO,CAAE,IAAI,CAACA,OAAO,GAEzB,CAEA;AACA2C,iBAAiBA,CAACC,OAAO,CAAE,CACzB,KAAM,CAAAC,YAAY,CAAG,EAAE,CACvB,IAAK,KAAM,CAAAxB,GAAG,GAAI,KAAI,CAACvB,KAAK,CAAC+B,IAAI,CAAC,CAAC,CAAE,CACnC,GAAIR,GAAG,CAACyB,QAAQ,CAACF,OAAO,CAAC,CAAE,CACzBC,YAAY,CAACE,IAAI,CAAC1B,GAAG,CAAC,CACxB,CACF,CAEAwB,YAAY,CAACG,OAAO,CAAC3B,GAAG,EAAI,IAAI,CAACU,MAAM,CAACV,GAAG,CAAC,CAAC,CAC7C,MAAO,CAAAwB,YAAY,CAACpB,MAAM,CAC5B,CAEA;AACA,KAAM,CAAAwB,oBAAoBA,CAAA,CAAG,CAC3B,GAAI,CACF,KAAM,CAAAC,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAC3C,GAAI,CAACF,KAAK,CAAE,OAEZ,KAAM,CAAAG,OAAO,CAAG,CAAE,eAAe,WAAAtC,MAAA,CAAYmC,KAAK,CAAG,CAAC,CAEtD;AACA,KAAM,CAAAI,iBAAiB,CAAG,KAAM,CAAAC,KAAK,CAAC,yBAAyB,CAAE,CAAEF,OAAQ,CAAC,CAAC,CAC7E,GAAIC,iBAAiB,CAACE,EAAE,CAAE,CACxB,KAAM,CAAAhD,SAAS,CAAG,KAAM,CAAA8C,iBAAiB,CAACG,IAAI,CAAC,CAAC,CAChD,IAAI,CAAClD,sBAAsB,CAACC,SAAS,CAACkD,IAAI,CAAC,CAC7C,CAEA;AACA,KAAM,CAAAC,YAAY,CAAG,KAAM,CAAAJ,KAAK,CAAC,oBAAoB,CAAE,CAAEF,OAAQ,CAAC,CAAC,CACnE,GAAIM,YAAY,CAACH,EAAE,CAAE,CACnB,KAAM,CAAAI,IAAI,CAAG,KAAM,CAAAD,YAAY,CAACF,IAAI,CAAC,CAAC,CACtC,IAAI,CAAChD,GAAG,CAAC,cAAc,CAAEmD,IAAI,CAACF,IAAI,CAAE,EAAE,CAAG,EAAE,CAAG,IAAI,CAAC,CAAE;AACvD,CAEF,CAAE,MAAOG,KAAK,CAAE,CACdC,OAAO,CAACC,IAAI,CAAC,uBAAuB,CAAEF,KAAK,CAAC,CAC9C,CACF,CACF,CAEA;AACA,KAAM,CAAAG,cAAc,CAAG,GAAI,CAAApE,cAAc,CAAC,CAAC,CAE3C;AACA,GAAIqE,OAAO,CAACC,GAAG,CAACC,QAAQ,GAAK,aAAa,CAAE,CAC1CC,MAAM,CAACJ,cAAc,CAAGA,cAAc,CACxC,CAEA,cAAe,CAAAA,cAAc","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}