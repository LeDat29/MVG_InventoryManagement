{"ast":null,"code":"/**\r\n * Cache Optimizer - KHO MVG\r\n * Quản lý cache để tối ưu hiệu suất\r\n */\n\nclass CacheOptimizer {\n  constructor() {\n    this.cache = new Map();\n    this.maxSize = 100;\n    this.defaultTTL = 5 * 60 * 1000; // 5 minutes\n    this.stats = {\n      hits: 0,\n      misses: 0,\n      sets: 0,\n      deletes: 0\n    };\n  }\n\n  // Cache contract templates\n  cacheContractTemplates(templates) {\n    this.set('contract_templates', templates, 10 * 60 * 1000); // 10 minutes\n  }\n  getContractTemplates() {\n    return this.get('contract_templates');\n  }\n\n  // Cache customer data\n  cacheCustomer(customerId, customerData) {\n    this.set(`customer_${customerId}`, customerData, 5 * 60 * 1000);\n  }\n  getCustomer(customerId) {\n    return this.get(`customer_${customerId}`);\n  }\n\n  // Cache contract data\n  cacheContract(contractId, contractData) {\n    this.set(`contract_${contractId}`, contractData, 3 * 60 * 1000);\n  }\n  getContract(contractId) {\n    return this.get(`contract_${contractId}`);\n  }\n\n  // Generic cache methods\n  set(key, value, ttl = this.defaultTTL) {\n    // Remove oldest item if cache is full\n    if (this.cache.size >= this.maxSize) {\n      const oldestKey = this.cache.keys().next().value;\n      this.cache.delete(oldestKey);\n      this.stats.deletes++;\n    }\n    this.cache.set(key, {\n      value,\n      timestamp: Date.now(),\n      ttl\n    });\n    this.stats.sets++;\n  }\n  get(key) {\n    const item = this.cache.get(key);\n    if (!item) {\n      this.stats.misses++;\n      return null;\n    }\n\n    // Check if item has expired\n    if (Date.now() - item.timestamp > item.ttl) {\n      this.cache.delete(key);\n      this.stats.deletes++;\n      this.stats.misses++;\n      return null;\n    }\n    this.stats.hits++;\n    return item.value;\n  }\n  delete(key) {\n    const deleted = this.cache.delete(key);\n    if (deleted) this.stats.deletes++;\n    return deleted;\n  }\n  clear() {\n    this.cache.clear();\n    this.stats = {\n      hits: 0,\n      misses: 0,\n      sets: 0,\n      deletes: 0\n    };\n  }\n\n  // Cache statistics\n  getStats() {\n    const total = this.stats.hits + this.stats.misses;\n    const hitRate = total > 0 ? this.stats.hits / total * 100 : 0;\n    return {\n      ...this.stats,\n      total,\n      hitRate: hitRate.toFixed(2),\n      size: this.cache.size,\n      maxSize: this.maxSize\n    };\n  }\n\n  // Invalidate related cache entries\n  invalidatePattern(pattern) {\n    const keysToDelete = [];\n    for (const key of this.cache.keys()) {\n      if (key.includes(pattern)) {\n        keysToDelete.push(key);\n      }\n    }\n    keysToDelete.forEach(key => this.delete(key));\n    return keysToDelete.length;\n  }\n\n  // Preload important data\n  async preloadEssentialData() {\n    try {\n      const token = localStorage.getItem('token');\n      if (!token) return;\n      const headers = {\n        'Authorization': `Bearer ${token}`\n      };\n\n      // Preload contract templates\n      const templatesResponse = await fetch('/api/contract-templates', {\n        headers\n      });\n      if (templatesResponse.ok) {\n        const templates = await templatesResponse.json();\n        this.cacheContractTemplates(templates.data);\n      }\n\n      // Preload user permissions if available\n      const userResponse = await fetch('/api/users/profile', {\n        headers\n      });\n      if (userResponse.ok) {\n        const user = await userResponse.json();\n        this.set('user_profile', user.data, 15 * 60 * 1000); // 15 minutes\n      }\n    } catch (error) {\n      console.warn('Cache preload failed:', error);\n    }\n  }\n}\n\n// Create singleton instance\nconst cacheOptimizer = new CacheOptimizer();\n\n// Expose to window for debugging\nif (process.env.NODE_ENV === 'development') {\n  window.cacheOptimizer = cacheOptimizer;\n}\nexport default cacheOptimizer;","map":{"version":3,"names":["CacheOptimizer","constructor","cache","Map","maxSize","defaultTTL","stats","hits","misses","sets","deletes","cacheContractTemplates","templates","set","getContractTemplates","get","cacheCustomer","customerId","customerData","getCustomer","cacheContract","contractId","contractData","getContract","key","value","ttl","size","oldestKey","keys","next","delete","timestamp","Date","now","item","deleted","clear","getStats","total","hitRate","toFixed","invalidatePattern","pattern","keysToDelete","includes","push","forEach","length","preloadEssentialData","token","localStorage","getItem","headers","templatesResponse","fetch","ok","json","data","userResponse","user","error","console","warn","cacheOptimizer","process","env","NODE_ENV","window"],"sources":["D:/MinhVietGroup/InventoryProject/MVG_InventoryManagement/KinhDoanh/client/src/utils/cacheOptimizer.js"],"sourcesContent":["/**\r\n * Cache Optimizer - KHO MVG\r\n * Quản lý cache để tối ưu hiệu suất\r\n */\r\n\r\nclass CacheOptimizer {\r\n  constructor() {\r\n    this.cache = new Map();\r\n    this.maxSize = 100;\r\n    this.defaultTTL = 5 * 60 * 1000; // 5 minutes\r\n    this.stats = {\r\n      hits: 0,\r\n      misses: 0,\r\n      sets: 0,\r\n      deletes: 0\r\n    };\r\n  }\r\n\r\n  // Cache contract templates\r\n  cacheContractTemplates(templates) {\r\n    this.set('contract_templates', templates, 10 * 60 * 1000); // 10 minutes\r\n  }\r\n\r\n  getContractTemplates() {\r\n    return this.get('contract_templates');\r\n  }\r\n\r\n  // Cache customer data\r\n  cacheCustomer(customerId, customerData) {\r\n    this.set(`customer_${customerId}`, customerData, 5 * 60 * 1000);\r\n  }\r\n\r\n  getCustomer(customerId) {\r\n    return this.get(`customer_${customerId}`);\r\n  }\r\n\r\n  // Cache contract data\r\n  cacheContract(contractId, contractData) {\r\n    this.set(`contract_${contractId}`, contractData, 3 * 60 * 1000);\r\n  }\r\n\r\n  getContract(contractId) {\r\n    return this.get(`contract_${contractId}`);\r\n  }\r\n\r\n  // Generic cache methods\r\n  set(key, value, ttl = this.defaultTTL) {\r\n    // Remove oldest item if cache is full\r\n    if (this.cache.size >= this.maxSize) {\r\n      const oldestKey = this.cache.keys().next().value;\r\n      this.cache.delete(oldestKey);\r\n      this.stats.deletes++;\r\n    }\r\n\r\n    this.cache.set(key, {\r\n      value,\r\n      timestamp: Date.now(),\r\n      ttl\r\n    });\r\n    this.stats.sets++;\r\n  }\r\n\r\n  get(key) {\r\n    const item = this.cache.get(key);\r\n    \r\n    if (!item) {\r\n      this.stats.misses++;\r\n      return null;\r\n    }\r\n\r\n    // Check if item has expired\r\n    if (Date.now() - item.timestamp > item.ttl) {\r\n      this.cache.delete(key);\r\n      this.stats.deletes++;\r\n      this.stats.misses++;\r\n      return null;\r\n    }\r\n\r\n    this.stats.hits++;\r\n    return item.value;\r\n  }\r\n\r\n  delete(key) {\r\n    const deleted = this.cache.delete(key);\r\n    if (deleted) this.stats.deletes++;\r\n    return deleted;\r\n  }\r\n\r\n  clear() {\r\n    this.cache.clear();\r\n    this.stats = {\r\n      hits: 0,\r\n      misses: 0,\r\n      sets: 0,\r\n      deletes: 0\r\n    };\r\n  }\r\n\r\n  // Cache statistics\r\n  getStats() {\r\n    const total = this.stats.hits + this.stats.misses;\r\n    const hitRate = total > 0 ? (this.stats.hits / total) * 100 : 0;\r\n    \r\n    return {\r\n      ...this.stats,\r\n      total,\r\n      hitRate: hitRate.toFixed(2),\r\n      size: this.cache.size,\r\n      maxSize: this.maxSize\r\n    };\r\n  }\r\n\r\n  // Invalidate related cache entries\r\n  invalidatePattern(pattern) {\r\n    const keysToDelete = [];\r\n    for (const key of this.cache.keys()) {\r\n      if (key.includes(pattern)) {\r\n        keysToDelete.push(key);\r\n      }\r\n    }\r\n    \r\n    keysToDelete.forEach(key => this.delete(key));\r\n    return keysToDelete.length;\r\n  }\r\n\r\n  // Preload important data\r\n  async preloadEssentialData() {\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      if (!token) return;\r\n\r\n      const headers = { 'Authorization': `Bearer ${token}` };\r\n      \r\n      // Preload contract templates\r\n      const templatesResponse = await fetch('/api/contract-templates', { headers });\r\n      if (templatesResponse.ok) {\r\n        const templates = await templatesResponse.json();\r\n        this.cacheContractTemplates(templates.data);\r\n      }\r\n\r\n      // Preload user permissions if available\r\n      const userResponse = await fetch('/api/users/profile', { headers });\r\n      if (userResponse.ok) {\r\n        const user = await userResponse.json();\r\n        this.set('user_profile', user.data, 15 * 60 * 1000); // 15 minutes\r\n      }\r\n\r\n    } catch (error) {\r\n      console.warn('Cache preload failed:', error);\r\n    }\r\n  }\r\n}\r\n\r\n// Create singleton instance\r\nconst cacheOptimizer = new CacheOptimizer();\r\n\r\n// Expose to window for debugging\r\nif (process.env.NODE_ENV === 'development') {\r\n  window.cacheOptimizer = cacheOptimizer;\r\n}\r\n\r\nexport default cacheOptimizer;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}