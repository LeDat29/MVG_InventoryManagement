{"ast":null,"code":"/**\r\n * Customer Service - API calls for customer management\r\n */\n\nconst API_BASE = process.env.REACT_APP_API_URL || 'http://localhost:5001/api';\nclass CustomerService {\n  async getAuthHeaders(noCache = false) {\n    const token = localStorage.getItem('token');\n\n    // Debug thông tin auth\n    if (!token) {\n      console.warn('⚠️ No token found in localStorage');\n    } else {\n      console.log('✅ Token found, length:', token.length);\n    }\n    const headers = {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${token}`\n    };\n    if (noCache) {\n      headers['Cache-Control'] = 'no-cache';\n      headers['Pragma'] = 'no-cache';\n    }\n    return headers;\n  }\n  async handleResponse(response) {\n    const data = await response.json();\n    if (!response.ok) {\n      // Debug thông tin chi tiết về lỗi\n      console.error('❌ CustomerService API Error:');\n      console.error('  Status:', response.status);\n      console.error('  Status Text:', response.statusText);\n      console.error('  Response Data:', data);\n\n      // Kiểm tra lỗi validation cụ thể\n      if (response.status === 400 && data.errors) {\n        console.error('  Validation Errors:');\n        data.errors.forEach(err => {\n          console.error(`    - ${err.path || err.param}: ${err.msg}`);\n        });\n      }\n      throw new Error(data.message || `HTTP error! status: ${response.status}`);\n    }\n    return data;\n  }\n\n  // Lấy danh sách khách hàng\n  async getCustomers(params = {}) {\n    const queryString = new URLSearchParams(params).toString();\n    const url = `${API_BASE}/customers${queryString ? `?${queryString}` : ''}`;\n    const response = await fetch(url, {\n      method: 'GET',\n      headers: await this.getAuthHeaders(true) // Force no-cache for fresh data\n    });\n    return this.handleResponse(response);\n  }\n\n  // Lấy chi tiết khách hàng\n  async getCustomer(id) {\n    const response = await fetch(`${API_BASE}/customers/${id}`, {\n      method: 'GET',\n      headers: await this.getAuthHeaders()\n    });\n    return this.handleResponse(response);\n  }\n\n  // Tạo khách hàng mới\n  async createCustomer(customerData) {\n    const response = await fetch(`${API_BASE}/customers`, {\n      method: 'POST',\n      headers: await this.getAuthHeaders(),\n      body: JSON.stringify(customerData)\n    });\n    return this.handleResponse(response);\n  }\n\n  // Cập nhật khách hàng\n  async updateCustomer(id, customerData) {\n    const response = await fetch(`${API_BASE}/customers/${id}`, {\n      method: 'PUT',\n      headers: await this.getAuthHeaders(),\n      body: JSON.stringify(customerData)\n    });\n    return this.handleResponse(response);\n  }\n\n  // Xóa khách hàng\n  async deleteCustomer(id) {\n    const response = await fetch(`${API_BASE}/customers/${id}`, {\n      method: 'DELETE',\n      headers: await this.getAuthHeaders()\n    });\n    return this.handleResponse(response);\n  }\n\n  // Lấy hợp đồng của khách hàng\n  async getCustomerContracts(customerId, status = null) {\n    const params = status ? {\n      status\n    } : {};\n    const queryString = new URLSearchParams(params).toString();\n    const url = `${API_BASE}/customers/${customerId}/contracts${queryString ? `?${queryString}` : ''}`;\n    const response = await fetch(url, {\n      method: 'GET',\n      headers: await this.getAuthHeaders()\n    });\n    return this.handleResponse(response);\n  }\n\n  // Tạo hợp đồng mới\n  async createContract(contractData) {\n    const response = await fetch(`${API_BASE}/customers/contracts`, {\n      method: 'POST',\n      headers: await this.getAuthHeaders(),\n      body: JSON.stringify(contractData)\n    });\n    return this.handleResponse(response);\n  }\n\n  // Lấy hợp đồng sắp hết hạn\n  async getExpiringContracts(days = 30) {\n    const response = await fetch(`${API_BASE}/customers/contracts/expiring?days=${days}`, {\n      method: 'GET',\n      headers: await this.getAuthHeaders()\n    });\n    return this.handleResponse(response);\n  }\n\n  // Lấy thống kê khách hàng\n  async getCustomerStats() {\n    const response = await fetch(`${API_BASE}/customers/stats`, {\n      method: 'GET',\n      headers: await this.getAuthHeaders()\n    });\n    return this.handleResponse(response);\n  }\n}\nconst customerService = new CustomerService();\nexport default customerService;","map":{"version":3,"names":["API_BASE","process","env","REACT_APP_API_URL","CustomerService","getAuthHeaders","noCache","token","localStorage","getItem","console","warn","log","length","headers","handleResponse","response","data","json","ok","error","status","statusText","errors","forEach","err","path","param","msg","Error","message","getCustomers","params","queryString","URLSearchParams","toString","url","fetch","method","getCustomer","id","createCustomer","customerData","body","JSON","stringify","updateCustomer","deleteCustomer","getCustomerContracts","customerId","createContract","contractData","getExpiringContracts","days","getCustomerStats","customerService"],"sources":["D:/MinhVietGroup/InventoryProject/MVG_InventoryManagement/KinhDoanh/client/src/services/customerService.js"],"sourcesContent":["/**\r\n * Customer Service - API calls for customer management\r\n */\r\n\r\nconst API_BASE = process.env.REACT_APP_API_URL || 'http://localhost:5001/api';\r\n\r\nclass CustomerService {\r\n  async getAuthHeaders(noCache = false) {\r\n    const token = localStorage.getItem('token');\r\n    \r\n    // Debug thông tin auth\r\n    if (!token) {\r\n      console.warn('⚠️ No token found in localStorage');\r\n    } else {\r\n      console.log('✅ Token found, length:', token.length);\r\n    }\r\n    \r\n    const headers = {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${token}`\r\n    };\r\n    \r\n    if (noCache) {\r\n      headers['Cache-Control'] = 'no-cache';\r\n      headers['Pragma'] = 'no-cache';\r\n    }\r\n    \r\n    return headers;\r\n  }\r\n\r\n  async handleResponse(response) {\r\n    const data = await response.json();\r\n    \r\n    if (!response.ok) {\r\n      // Debug thông tin chi tiết về lỗi\r\n      console.error('❌ CustomerService API Error:');\r\n      console.error('  Status:', response.status);\r\n      console.error('  Status Text:', response.statusText);\r\n      console.error('  Response Data:', data);\r\n      \r\n      // Kiểm tra lỗi validation cụ thể\r\n      if (response.status === 400 && data.errors) {\r\n        console.error('  Validation Errors:');\r\n        data.errors.forEach(err => {\r\n          console.error(`    - ${err.path || err.param}: ${err.msg}`);\r\n        });\r\n      }\r\n      \r\n      throw new Error(data.message || `HTTP error! status: ${response.status}`);\r\n    }\r\n    \r\n    return data;\r\n  }\r\n\r\n  // Lấy danh sách khách hàng\r\n  async getCustomers(params = {}) {\r\n    const queryString = new URLSearchParams(params).toString();\r\n    const url = `${API_BASE}/customers${queryString ? `?${queryString}` : ''}`;\r\n    \r\n    const response = await fetch(url, {\r\n      method: 'GET',\r\n      headers: await this.getAuthHeaders(true) // Force no-cache for fresh data\r\n    });\r\n    \r\n    return this.handleResponse(response);\r\n  }\r\n\r\n  // Lấy chi tiết khách hàng\r\n  async getCustomer(id) {\r\n    const response = await fetch(`${API_BASE}/customers/${id}`, {\r\n      method: 'GET',\r\n      headers: await this.getAuthHeaders()\r\n    });\r\n    \r\n    return this.handleResponse(response);\r\n  }\r\n\r\n  // Tạo khách hàng mới\r\n  async createCustomer(customerData) {\r\n    const response = await fetch(`${API_BASE}/customers`, {\r\n      method: 'POST',\r\n      headers: await this.getAuthHeaders(),\r\n      body: JSON.stringify(customerData)\r\n    });\r\n    \r\n    return this.handleResponse(response);\r\n  }\r\n\r\n  // Cập nhật khách hàng\r\n  async updateCustomer(id, customerData) {\r\n    const response = await fetch(`${API_BASE}/customers/${id}`, {\r\n      method: 'PUT',\r\n      headers: await this.getAuthHeaders(),\r\n      body: JSON.stringify(customerData)\r\n    });\r\n    \r\n    return this.handleResponse(response);\r\n  }\r\n\r\n  // Xóa khách hàng\r\n  async deleteCustomer(id) {\r\n    const response = await fetch(`${API_BASE}/customers/${id}`, {\r\n      method: 'DELETE',\r\n      headers: await this.getAuthHeaders()\r\n    });\r\n    \r\n    return this.handleResponse(response);\r\n  }\r\n\r\n  // Lấy hợp đồng của khách hàng\r\n  async getCustomerContracts(customerId, status = null) {\r\n    const params = status ? { status } : {};\r\n    const queryString = new URLSearchParams(params).toString();\r\n    const url = `${API_BASE}/customers/${customerId}/contracts${queryString ? `?${queryString}` : ''}`;\r\n    \r\n    const response = await fetch(url, {\r\n      method: 'GET',\r\n      headers: await this.getAuthHeaders()\r\n    });\r\n    \r\n    return this.handleResponse(response);\r\n  }\r\n\r\n  // Tạo hợp đồng mới\r\n  async createContract(contractData) {\r\n    const response = await fetch(`${API_BASE}/customers/contracts`, {\r\n      method: 'POST',\r\n      headers: await this.getAuthHeaders(),\r\n      body: JSON.stringify(contractData)\r\n    });\r\n    \r\n    return this.handleResponse(response);\r\n  }\r\n\r\n  // Lấy hợp đồng sắp hết hạn\r\n  async getExpiringContracts(days = 30) {\r\n    const response = await fetch(`${API_BASE}/customers/contracts/expiring?days=${days}`, {\r\n      method: 'GET',\r\n      headers: await this.getAuthHeaders()\r\n    });\r\n    \r\n    return this.handleResponse(response);\r\n  }\r\n\r\n  // Lấy thống kê khách hàng\r\n  async getCustomerStats() {\r\n    const response = await fetch(`${API_BASE}/customers/stats`, {\r\n      method: 'GET',\r\n      headers: await this.getAuthHeaders()\r\n    });\r\n    \r\n    return this.handleResponse(response);\r\n  }\r\n}\r\n\r\nconst customerService = new CustomerService();\r\nexport default customerService;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}