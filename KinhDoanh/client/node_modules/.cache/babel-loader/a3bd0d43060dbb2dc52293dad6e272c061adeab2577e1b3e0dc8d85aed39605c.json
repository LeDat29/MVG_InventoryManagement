{"ast":null,"code":"/**\r\n * Customer Service - API calls for customer management\r\n */const API_BASE=process.env.REACT_APP_API_URL||'http://localhost:5001/api';class CustomerService{async getAuthHeaders(){let noCache=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;const token=localStorage.getItem('token');// Debug thông tin auth\nif(!token){console.warn('⚠️ No token found in localStorage');}else{console.log('✅ Token found, length:',token.length);}const headers={'Content-Type':'application/json','Authorization':\"Bearer \".concat(token)};if(noCache){headers['Cache-Control']='no-cache';headers['Pragma']='no-cache';}return headers;}async handleResponse(response){const data=await response.json();if(!response.ok){// Debug thông tin chi tiết về lỗi\nconsole.error('❌ CustomerService API Error:');console.error('  Status:',response.status);console.error('  Status Text:',response.statusText);console.error('  Response Data:',data);// Kiểm tra lỗi validation cụ thể\nif(response.status===400&&data.errors){console.error('  Validation Errors:');data.errors.forEach(err=>{console.error(\"    - \".concat(err.path||err.param,\": \").concat(err.msg));});}throw new Error(data.message||\"HTTP error! status: \".concat(response.status));}return data;}// Lấy danh sách khách hàng\nasync getCustomers(){let params=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};const queryString=new URLSearchParams(params).toString();const url=\"\".concat(API_BASE,\"/customers\").concat(queryString?\"?\".concat(queryString):'');const response=await fetch(url,{method:'GET',headers:await this.getAuthHeaders(true)// Force no-cache for fresh data\n});return this.handleResponse(response);}// Lấy chi tiết khách hàng\nasync getCustomer(id){const response=await fetch(\"\".concat(API_BASE,\"/customers/\").concat(id),{method:'GET',headers:await this.getAuthHeaders()});return this.handleResponse(response);}// Tạo khách hàng mới\nasync createCustomer(customerData){const response=await fetch(\"\".concat(API_BASE,\"/customers\"),{method:'POST',headers:await this.getAuthHeaders(),body:JSON.stringify(customerData)});return this.handleResponse(response);}// Cập nhật khách hàng\nasync updateCustomer(id,customerData){const response=await fetch(\"\".concat(API_BASE,\"/customers/\").concat(id),{method:'PUT',headers:await this.getAuthHeaders(),body:JSON.stringify(customerData)});return this.handleResponse(response);}// Xóa khách hàng\nasync deleteCustomer(id){const response=await fetch(\"\".concat(API_BASE,\"/customers/\").concat(id),{method:'DELETE',headers:await this.getAuthHeaders()});return this.handleResponse(response);}// Lấy hợp đồng của khách hàng\nasync getCustomerContracts(customerId){let status=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;const params=status?{status}:{};const queryString=new URLSearchParams(params).toString();const url=\"\".concat(API_BASE,\"/customers/\").concat(customerId,\"/contracts\").concat(queryString?\"?\".concat(queryString):'');const response=await fetch(url,{method:'GET',headers:await this.getAuthHeaders()});return this.handleResponse(response);}// Tạo hợp đồng mới\nasync createContract(contractData){const response=await fetch(\"\".concat(API_BASE,\"/customers/contracts\"),{method:'POST',headers:await this.getAuthHeaders(),body:JSON.stringify(contractData)});return this.handleResponse(response);}// Lấy hợp đồng sắp hết hạn\nasync getExpiringContracts(){let days=arguments.length>0&&arguments[0]!==undefined?arguments[0]:30;const response=await fetch(\"\".concat(API_BASE,\"/customers/contracts/expiring?days=\").concat(days),{method:'GET',headers:await this.getAuthHeaders()});return this.handleResponse(response);}// Lấy thống kê khách hàng\nasync getCustomerStats(){const response=await fetch(\"\".concat(API_BASE,\"/customers/stats\"),{method:'GET',headers:await this.getAuthHeaders()});return this.handleResponse(response);}}const customerService=new CustomerService();export default customerService;","map":{"version":3,"names":["API_BASE","process","env","REACT_APP_API_URL","CustomerService","getAuthHeaders","noCache","arguments","length","undefined","token","localStorage","getItem","console","warn","log","headers","concat","handleResponse","response","data","json","ok","error","status","statusText","errors","forEach","err","path","param","msg","Error","message","getCustomers","params","queryString","URLSearchParams","toString","url","fetch","method","getCustomer","id","createCustomer","customerData","body","JSON","stringify","updateCustomer","deleteCustomer","getCustomerContracts","customerId","createContract","contractData","getExpiringContracts","days","getCustomerStats","customerService"],"sources":["C:/KinhDoanh/client/src/services/customerService.js"],"sourcesContent":["/**\r\n * Customer Service - API calls for customer management\r\n */\r\n\r\nconst API_BASE = process.env.REACT_APP_API_URL || 'http://localhost:5001/api';\r\n\r\nclass CustomerService {\r\n  async getAuthHeaders(noCache = false) {\r\n    const token = localStorage.getItem('token');\r\n    \r\n    // Debug thông tin auth\r\n    if (!token) {\r\n      console.warn('⚠️ No token found in localStorage');\r\n    } else {\r\n      console.log('✅ Token found, length:', token.length);\r\n    }\r\n    \r\n    const headers = {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${token}`\r\n    };\r\n    \r\n    if (noCache) {\r\n      headers['Cache-Control'] = 'no-cache';\r\n      headers['Pragma'] = 'no-cache';\r\n    }\r\n    \r\n    return headers;\r\n  }\r\n\r\n  async handleResponse(response) {\r\n    const data = await response.json();\r\n    \r\n    if (!response.ok) {\r\n      // Debug thông tin chi tiết về lỗi\r\n      console.error('❌ CustomerService API Error:');\r\n      console.error('  Status:', response.status);\r\n      console.error('  Status Text:', response.statusText);\r\n      console.error('  Response Data:', data);\r\n      \r\n      // Kiểm tra lỗi validation cụ thể\r\n      if (response.status === 400 && data.errors) {\r\n        console.error('  Validation Errors:');\r\n        data.errors.forEach(err => {\r\n          console.error(`    - ${err.path || err.param}: ${err.msg}`);\r\n        });\r\n      }\r\n      \r\n      throw new Error(data.message || `HTTP error! status: ${response.status}`);\r\n    }\r\n    \r\n    return data;\r\n  }\r\n\r\n  // Lấy danh sách khách hàng\r\n  async getCustomers(params = {}) {\r\n    const queryString = new URLSearchParams(params).toString();\r\n    const url = `${API_BASE}/customers${queryString ? `?${queryString}` : ''}`;\r\n    \r\n    const response = await fetch(url, {\r\n      method: 'GET',\r\n      headers: await this.getAuthHeaders(true) // Force no-cache for fresh data\r\n    });\r\n    \r\n    return this.handleResponse(response);\r\n  }\r\n\r\n  // Lấy chi tiết khách hàng\r\n  async getCustomer(id) {\r\n    const response = await fetch(`${API_BASE}/customers/${id}`, {\r\n      method: 'GET',\r\n      headers: await this.getAuthHeaders()\r\n    });\r\n    \r\n    return this.handleResponse(response);\r\n  }\r\n\r\n  // Tạo khách hàng mới\r\n  async createCustomer(customerData) {\r\n    const response = await fetch(`${API_BASE}/customers`, {\r\n      method: 'POST',\r\n      headers: await this.getAuthHeaders(),\r\n      body: JSON.stringify(customerData)\r\n    });\r\n    \r\n    return this.handleResponse(response);\r\n  }\r\n\r\n  // Cập nhật khách hàng\r\n  async updateCustomer(id, customerData) {\r\n    const response = await fetch(`${API_BASE}/customers/${id}`, {\r\n      method: 'PUT',\r\n      headers: await this.getAuthHeaders(),\r\n      body: JSON.stringify(customerData)\r\n    });\r\n    \r\n    return this.handleResponse(response);\r\n  }\r\n\r\n  // Xóa khách hàng\r\n  async deleteCustomer(id) {\r\n    const response = await fetch(`${API_BASE}/customers/${id}`, {\r\n      method: 'DELETE',\r\n      headers: await this.getAuthHeaders()\r\n    });\r\n    \r\n    return this.handleResponse(response);\r\n  }\r\n\r\n  // Lấy hợp đồng của khách hàng\r\n  async getCustomerContracts(customerId, status = null) {\r\n    const params = status ? { status } : {};\r\n    const queryString = new URLSearchParams(params).toString();\r\n    const url = `${API_BASE}/customers/${customerId}/contracts${queryString ? `?${queryString}` : ''}`;\r\n    \r\n    const response = await fetch(url, {\r\n      method: 'GET',\r\n      headers: await this.getAuthHeaders()\r\n    });\r\n    \r\n    return this.handleResponse(response);\r\n  }\r\n\r\n  // Tạo hợp đồng mới\r\n  async createContract(contractData) {\r\n    const response = await fetch(`${API_BASE}/customers/contracts`, {\r\n      method: 'POST',\r\n      headers: await this.getAuthHeaders(),\r\n      body: JSON.stringify(contractData)\r\n    });\r\n    \r\n    return this.handleResponse(response);\r\n  }\r\n\r\n  // Lấy hợp đồng sắp hết hạn\r\n  async getExpiringContracts(days = 30) {\r\n    const response = await fetch(`${API_BASE}/customers/contracts/expiring?days=${days}`, {\r\n      method: 'GET',\r\n      headers: await this.getAuthHeaders()\r\n    });\r\n    \r\n    return this.handleResponse(response);\r\n  }\r\n\r\n  // Lấy thống kê khách hàng\r\n  async getCustomerStats() {\r\n    const response = await fetch(`${API_BASE}/customers/stats`, {\r\n      method: 'GET',\r\n      headers: await this.getAuthHeaders()\r\n    });\r\n    \r\n    return this.handleResponse(response);\r\n  }\r\n}\r\n\r\nconst customerService = new CustomerService();\r\nexport default customerService;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}